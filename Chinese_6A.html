<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PSLE ÂçéÊñáÈó™Âç° (PSLE Chinese Flashcards)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
            20%, 40%, 60%, 80% { transform: translateX(8px); }
        }
        .shake { animation: shake 0.5s ease-in-out; }

        .correct-state-static {
            background-color: #22c55e !important; /* green-500 */
            color: white !important;
        }
        .correct-state-static #questionText { display: none !important; }
        .correct-state-static #feedbackText,
        .correct-state-static #feedbackIconContainer,
        .correct-state-static #questionImagePlaceholder { color: white !important; }

        .incorrect-state {
            background-color: #ef4444 !important; /* red-500 */
            color: white !important;
            border-color: #b91c1c !important; /* red-700 */
        }
        .incorrect-state #questionText { display: none !important; }
        .incorrect-state #feedbackText,
        .incorrect-state #feedbackIconContainer { color: white !important; }

        /* NEW: Styles for Enhanced Incorrect Answer Feedback */
        .feedback-sentence-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 1rem;
        }
        .feedback-word-group {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .feedback-word {
            font-size: 1.75rem; /* Larger font for the Chinese words */
            font-weight: 700;
            line-height: 1.2;
            color: #ffffff;
        }
        .feedback-pinyin {
            font-size: 0.875rem;
            font-weight: 400;
            color: rgba(255, 255, 255, 0.85);
        }
        .english-explanation {
            font-size: 0.95rem;
            font-weight: 500;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 0.75rem;
            border-radius: 0.375rem;
            margin-top: 1rem;
            text-align: left;
        }
        .prompt-guidance {
             font-size: 0.875rem; display: block; margin-top: 0.75rem; font-weight: normal;
        }

        .choice-button, .action-button {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            border-radius: 0.5rem; font-weight: 600;
            padding: 0.75rem 0.5rem; text-align: center;
            border: 1px solid transparent;
        }
        .choice-button:hover:not(:disabled), .action-button:hover {
            transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.12);
        }
        .choice-button:active:not(:disabled), .action-button:active {
            transform: translateY(0px); box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .choice-button:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
        .choice-button.forced-disabled-look { opacity: 0.5; }
        .choice-button:disabled:hover { transform: none; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }

        .clickable-card { cursor: pointer; }
        #progressBarFill { transition: width 0.3s ease-out; }
        #confettiCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
        
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 500px; border-radius: 0.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }

        .race-track-container { position: relative; width: 100%; height: 30px; margin-top: 20px; margin-bottom: 20px; z-index: 1; }
        .race-track { position: absolute; bottom: 0; left: 0; width: calc(100% - 30px); height: 10px; background-color: #d1d5db; border-radius: 5px; z-index: 2; }
        .race-track-fill { position: absolute; bottom: 0; left: 0; height: 10px; background-color: #3b82f6; border-radius: 5px; width: 0%; z-index: 3; transition: width 1.5s ease-out; }
        .rocket { position: absolute; bottom: -8px; left: 0; font-size: 36px; transform: translateX(-50%); z-index: 10; transition: left 1.5s ease-out; }
        .checkered-flag { position: absolute; bottom: -8px; right: 0; font-size: 24px; transform: translateX(50%); z-index: 10; }

        #questionText { word-break: break-word; hyphens: auto; }
        /* Increased font size for questions and choices */
        .set23-text #questionText { font-size: 1.875rem; line-height: 2.25rem; } /* text-3xl */
        .set23-text .choice-button { font-size: 1.25rem; } /* text-xl */

        .choice-button { white-space: normal; word-break: break-word; line-height: 1.4; min-height: 60px; display: flex; align-items: center; justify-content: center; font-size: 1.125rem; }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-rose-100 via-amber-100 to-orange-100 min-h-screen flex items-center justify-center p-4">

    <div id="appContainer" class="w-full max-w-md mx-auto">

        <!-- Name Input Modal -->
         <div id="nameModal" class="modal">
             <div class="modal-content text-center">
                 <h2 class="text-xl md:text-2xl font-semibold mb-4 text-red-700">Ê¨¢ËøéÔºåÂçéÊñáÂ≠¶‰π†ËÄÖÔºÅ</h2>
                 <p class="text-slate-600 mb-4">ËØ∑ËæìÂÖ•‰Ω†ÁöÑÂêçÂ≠óÔºåÂºÄÂßã‰Ω†ÁöÑPSLEÂçéÊñáÂ§ç‰π†‰πãÊóÖ„ÄÇ</p>
                 <input type="text" id="userNameInput" placeholder="‰Ω†ÁöÑÂêçÂ≠ó" class="w-full p-2 border border-slate-300 rounded mb-4 focus:ring-red-500 focus:border-red-500 text-center text-lg">
                 <button onclick="saveUserName()" class="action-button bg-red-500 hover:bg-red-600 text-white w-full py-3 px-6 text-lg">ÂºÄÂßãÂ≠¶‰π†ÔºÅ</button>
             </div>
         </div>

        <!-- Set Selection Screen -->
        <div id="setSelectionScreen" class="hidden bg-white p-6 md:p-8 rounded-xl shadow-lg text-center">
            <h1 class="text-2xl md:text-3xl font-bold text-red-800 mb-2">PSLE ÂçéÊñáÁªÉ‰π†</h1>
            <p class="text-slate-600 mb-8">ËØ∑ÈÄâÊã©‰∏Ä‰∏™È¢òÁªÑÊù•Â∑©Âõ∫‰Ω†ÁöÑÁü•ËØÜÔºÅ</p>
            <div id="setButtonsContainer" class="grid grid-cols-1 gap-4">
                <!-- Buttons for flashcard sets will be dynamically added here by JS -->
            </div>
        </div>

        <!-- Flashcard Screen -->
        <div id="flashcardScreen" class="hidden bg-white p-6 md:p-8 rounded-xl shadow-lg">
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-slate-600">ËøõÂ∫¶</span>
                    <span id="progressText" class="text-sm font-medium text-red-700">0 / 0</span> </div>
                <div class="w-full bg-slate-200 rounded-full h-2.5">
                    <div id="progressBarFill" class="bg-red-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
            </div>

            <div id="flashcard" class="bg-white border border-slate-300 rounded-lg p-6 mb-6 text-center min-h-[200px] flex flex-col items-center justify-center transition-colors duration-300">
                 <div id="flashcardContent" class="w-full flex flex-col items-center justify-center">
                     <div id="feedbackIconContainer" class="hidden text-7xl md:text-8xl mb-2"></div>
                     <p id="questionText" class="text-2xl md:text-3xl font-semibold text-slate-800"></p>
                     <div id="feedbackText" class="mt-2 text-base md:text-lg font-semibold w-full"></div>
                     <p id="continueText" class="mt-4 text-sm text-slate-500 hidden">ÁÇπÂáªÂç°ÁâáÁªßÁª≠...</p>
                 </div>
            </div>

            <div id="answerChoices" class="grid grid-cols-1 gap-3 md:gap-4">
                <button id="choice1" class="choice-button bg-slate-100 hover:bg-slate-200 text-slate-700"></button>
                <button id="choice2" class="choice-button bg-slate-100 hover:bg-slate-200 text-slate-700"></button>
                <button id="choice3" class="choice-button bg-slate-100 hover:bg-slate-200 text-slate-700"></button>
            </div>
             <button onclick="showSetSelection()" class="action-button mt-6 bg-slate-500 hover:bg-slate-600 text-white w-full text-sm py-3 px-6">ËøîÂõûÈÄâÈ¢ò</button>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="hidden bg-white p-6 md:p-8 rounded-xl shadow-lg text-center">
            <h2 id="resultsHeading" class="text-2xl md:text-3xl font-bold text-red-700 mb-4"></h2>

            <div class="bg-emerald-500 text-white p-4 rounded-lg mb-6">
                <p class="text-lg md:text-xl font-semibold mb-1">‰Ω†ÁöÑÂàÜÊï∞:</p>
                <p id="scoreDisplay" class="text-4xl md:text-5xl font-bold italic"></p>
            </div>

            <div class="race-track-container">
                <div class="race-track"></div>
                <div id="raceTrackFill" class="race-track-fill bg-red-500"></div>
                <span id="rocketEl" class="rocket">üöÄ</span>
                <span id="checkeredFlag" class="checkered-flag">üèÅ</span>
            </div>
            <p class="text-lg text-slate-700 mb-2">Ê≠£Á°ÆÁéá: <span id="percentage" class="font-semibold"></span>%</p>
            <p class="text-lg text-slate-700 mb-6">Áî®Êó∂: <span id="timeTaken" class="font-semibold"></span> Áßí</p>

            <p id="encouragementText" class="text-lg text-red-700 font-semibold mb-6"></p>
            <div id="incorrectListContainer" class="mb-6 text-left">
                <h3 class="text-xl font-semibold text-red-600 mb-3">Â§ç‰π†ÈîôÈ¢ò:</h3>
                <ul id="incorrectList" class="list-disc list-inside space-y-2 text-slate-600 text-sm"></ul>
                 <p id="noIncorrectText" class="text-emerald-600 font-semibold hidden">Â§™Ê£í‰∫ÜÔºåÊ≤°ÊúâÈîôÈ¢òÔºÅ</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button id="redoIncorrectButton" onclick="redoIncorrect()" class="action-button bg-orange-500 hover:bg-orange-600 text-white w-full py-3 px-6">ÈáçÂÅöÈîôÈ¢ò</button>
                <button onclick="showSetSelection()" class="action-button bg-red-500 hover:bg-red-600 text-white w-full py-3 px-6">ÈÄâÊã©ÂÖ∂‰ªñÈ¢òÁªÑ</button>
            </div>
        </div>
    </div>

    <canvas id="confettiCanvas"></canvas>

<script>
    // --- Configuration ---
    const QUESTIONS_PER_SET = 20;
    const AUTO_PROCEED_DELAY = 1500;
    const USER_NAME_STORAGE_KEY = 'psleChineseApp_v2'; // Updated version key
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwxl5mcaKKp3rXABfN6tMDqzUMCZ7eUTUt3LeoO8xFlwlSTuJqbOMY9vNxwSatucjec/exec';

    // --- NEW FLASHCARD SETS with ENHANCED FEEDBACK ---
    const allFlashcardSets = {
        "Á¨¨‰∏ÄÁªÑÔºöËØçËØ≠Ëæ®Êûê (Easy)": [
            { id: 'c1q1', question: "Âì™‰∏™ËØçËØ≠ÁöÑÊÑèÊÄùÊòØÁî®ÊâãÊé®ÂºÄÈöúÁ¢çÁâ©Ôºü", options: ["Êã®ÂºÄ", "ÊãâÂºÄ", "ÊâìÂºÄ"], correctAnswer: "Êã®ÂºÄ", englishExplanation: "`Êã®` (b≈ç) means to push aside or to dial. `Êã®ÂºÄ` (b≈ç kƒÅi) specifically means to push something away, like pushing aside curtains." },
            { id: 'c1q2', question: "Ê°åÂ≠ê‰∏äÁöÑ‰π¶Êú¨ÊîæÔºà Ôºâ‰∫ÜÔºåËØ∑‰Ω†ÊääÂÆÉÊëÜÊ≠£„ÄÇ", options: ["Ê≠™Êñú", "ÂÄí‰∏ã", "Á´ØÊ≠£"], correctAnswer: "Ê≠™Êñú", englishExplanation: "`Ê≠™` (wƒÅi) means tilted or crooked. `Ê≠™Êñú` (wƒÅi xi√©) is a compound word that describes something not being straight or upright." },
            { id: 'c1q3', question: "ËøáÈ©¨Ë∑ØÊó∂ÔºåÊàë‰ª¨Ë¶ÅÂ∞èÂøÉÔºå‰∏çË¶ÅÔºà ÔºâÂà∞Âà´‰∫∫ÁöÑËÑö„ÄÇ", options: ["Ë∏©Âà∞", "Ë∏¢Âà∞", "Á¢∞Âà∞"], correctAnswer: "Ë∏©Âà∞", englishExplanation: "`Ë∏©` (c«éi) specifically means to step on something with your foot. `Ë∏©Âà∞` (c«éi d√†o) means to have stepped on something." },
            { id: 'c1q4', question: "Â¶àÂ¶àÔºà ÔºâÁùÄÂºüÂºüÁöÑÊâãÔºå‰∏ÄËµ∑ÂéªÂÖ¨Âõ≠Êï£Ê≠•„ÄÇ", options: ["ÁâµÁùÄ", "ÊãâÁùÄ", "Êè°ÁùÄ"], correctAnswer: "ÁâµÁùÄ", englishExplanation: "`Áâµ` (qiƒÅn) means to lead by holding the hand or a rope. It implies gentle guidance, perfect for `ÁâµÁùÄÊâã` (qiƒÅn zhe sh«íu) - holding hands." },
            { id: 'c1q5', question: "ÊàëÊúÄÂñúÊ¨¢ÂêÉÂ¶àÂ¶àÔºà ÔºâÁöÑËç∑ÂåÖËõã„ÄÇ", options: ["ÁÖé", "ÁÉ§", "Ëí∏"], correctAnswer: "ÁÖé", englishExplanation: "`ÁÖé` (jiƒÅn) means to pan-fry with a little oil. It's the correct cooking method for eggs in this context (`ÁÖéËõã`)." },
            { id: 'c1q6', question: "ËøôÂùóÈ•ºÂπ≤ÂèàÈ¶ôÂèàÔºà ÔºâÔºåÁúüÂ•ΩÂêÉÔºÅ", options: ["ËÑÜ", "ËΩØ", "Á°¨"], correctAnswer: "ËÑÜ", englishExplanation: "`ËÑÜ` (cu√¨) means crispy or brittle. `È¶ôËÑÜ` (xiƒÅng cu√¨ - fragrant and crispy) is a common phrase to praise food like biscuits or chips." },
            { id: 'c1q7', question: "Âë®Êú´ÔºåÁà∏Áà∏Â∏¶Êàë‰ª¨Âéª‰πåËäÇË∑ØÔºà ÔºâË°ó„ÄÇ", options: ["ÈÄõ", "Ëµ∞", "Áúã"], correctAnswer: "ÈÄõ", englishExplanation: "`ÈÄõ` (gu√†ng) means to stroll or to window-shop. `ÈÄõË°ó` (gu√†ng jiƒì) is the specific term for shopping or walking around a shopping district." },
            { id: 'c1q8', question: "Ëøô‰ª∂Áé©ÂÖ∑ÁöÑÔºà ÔºâÈí±ÊòØÂ§öÂ∞ëÔºü", options: ["‰ª∑", "ÂÄº", "ÂÆù"], correctAnswer: "‰ª∑", englishExplanation: "`‰ª∑` (ji√†) refers to price. `‰ª∑Èí±` (ji√† qian) is the word for 'price'." },
            { id: 'c1q9', question: "ÂÅö‰∫∫‰∏çËÉΩÔºà ÔºâÂøÉÔºåË¶ÅÊáÇÂæóÁü•Ë∂≥„ÄÇ", options: ["Ë¥™", "Ë¥´", "Âê´"], correctAnswer: "Ë¥™", englishExplanation: "`Ë¥™` (tƒÅn) means greedy. `Ë¥™ÂøÉ` (tƒÅn xƒ´n) means 'greedy' and fits the context of being content (`Áü•Ë∂≥`)." },
            { id: 'c1q10', question: "‰ªñÂ∑•‰ΩúÂæàÂä™ÂäõÔºå‰∏ÄÁÇπ‰πüÔºà ÔºâÊâãÁ¨®ËÑö„ÄÇ", options: ["‰∏çÁ¨®", "‰∏çÊÖ¢", "‰∏çÂø´"], correctAnswer: "‰∏çÁ¨®", englishExplanation: "`Á¨®` (b√®n) means clumsy or foolish. `Á¨®ÊâãÁ¨®ËÑö` (b√®n sh«íu b√®n ji«éo) is an idiom for being clumsy with one's hands and feet." },
            { id: 'c1q11', question: "‰ªñÂõ†‰∏∫ËøüÂà∞ËÄåÂèóÂà∞‰∫ÜËÄÅÂ∏àÁöÑÔºà Ôºâ„ÄÇ", options: ["ÊÉ©ÁΩö", "Â§∏Â•ñ", "ÊâπËØÑ"], correctAnswer: "ÊÉ©ÁΩö", englishExplanation: "`ÁΩö` (f√°) is the root character for punishment. `ÊÉ©ÁΩö` (ch√©ng f√°) is the formal word for 'punishment'." },
            { id: 'c1q12', question: "ÊûóËÇØÊòØÁæéÂõΩÂéÜÂè≤‰∏äÈùûÂ∏∏Ôºà ÔºâÂá∫ÁöÑÊÄªÁªü„ÄÇ", options: ["Êù∞", "‰ºò", "Â•Ω"], correctAnswer: "Êù∞", englishExplanation: "`Êù∞` (ji√©) means outstanding or heroic. `Êù∞Âá∫` (ji√© ch≈´) means 'distinguished' or 'outstanding', used for remarkable people or achievements." },
            { id: 'c1q13', question: "Â¶àÂ¶àÂú®Âé®ÊàøÈáåÂñäÈÅìÔºö‚ÄúÂø´Êù•Ôºà ÔºâÊàëÊääËèúÁ´ØÂá∫ÂéªÔºÅ‚Äù", options: ["Â∏Æ", "ÂÇ¨", "Êâ∂"], correctAnswer: "Â∏Æ", englishExplanation: "`ÂÇ¨` (cuƒ´) means to urge or hurry someone. The question context needs `Â∏Æ` (bƒÅng) which means 'to help'." },
            { id: 'c1q14', question: "‰ªñÁîüÁóÖ‰∫ÜÔºå‰ªäÂ§©Ôºà Ôºâ‰∫ÜÂ•ΩÂá†Ê¨°ËÇöÂ≠ê„ÄÇ", options: ["Ê≥ª", "Êãâ", "Ë∑ë"], correctAnswer: "Ê≥ª", englishExplanation: "`Ê≥ª` (xi√®) means to flow down rapidly, and is used in the term for diarrhea, `Ê≥ªËÇöÂ≠ê` (xi√® d√π zi)." },
            { id: 'c1q15', question: "ËøôÂÆ∂Â∫óÁöÑÁîüÊÑèÂæàÁÅ´ÁàÜÔºåÁúüÊòØÂ§™Ôºà ÔºâÂÆ≥‰∫ÜÔºÅ", options: ["Âéâ", "‰∏•", "Âá∂"], correctAnswer: "Âéâ", englishExplanation: "`Âéâ` (l√¨) can mean severe, but in `ÂéâÂÆ≥` (l√¨ hai) it means 'awesome' or 'impressive'." },
            { id: 'c1q16', question: "ËøôÂè•ËØùÊÑèÔºà ÔºâÊ∑±ÂàªÔºåÂÄºÂæóÊàë‰ª¨Â•ΩÂ•ΩÊÄùËÄÉ„ÄÇ", options: ["Âê´", "ÂåÖ", "Â∏¶"], correctAnswer: "Âê´", englishExplanation: "`Âê´` (h√°n) means to contain or to hold within. `Âê´‰πâ` (h√°n y√¨) means 'meaning' or 'implication'." },
            { id: 'c1q17', question: "ÂºüÂºüÁöÑË∫´‰ΩìÂæàÔºà ÔºâÔºåÂ∏∏Â∏∏ÁîüÁóÖ„ÄÇ", options: ["Áò¶Âº±", "Âº∫Â£Æ", "ÂÅ•Â∫∑"], correctAnswer: "Áò¶Âº±", englishExplanation: "`Âº±` (ru√≤) means weak. `Áò¶Âº±` (sh√≤u ru√≤) means thin and weak, fitting the context of getting sick often." },
            { id: 'c1q18', question: "‰ªñÂæàÔºà ÔºâÔºåËá™Â∑±ÁöÑ‰∫ãÊÉÖÊÄªÊòØË¶ÅÂà´‰∫∫Â∏ÆÂøôÂÅö„ÄÇ", options: ["ÊáíÊÉ∞", "Âã§Âä≥", "Âä™Âäõ"], correctAnswer: "ÊáíÊÉ∞", englishExplanation: "`Êáí` (l«én) means lazy. `ÊáíÊÉ∞` (l«én du√≤) is the full word for 'lazy'." },
            { id: 'c1q19', question: "Ë≠¶ÂØüÁöÑÂèçÂ∫îÈùûÂ∏∏Ôºà ÔºâÔºåÂæàÂø´Â∞±Êäì‰Ωè‰∫ÜÂ∞èÂÅ∑„ÄÇ", options: ["ÊïèÊç∑", "Âø´ÈÄü", "ËøÖÈÄü"], correctAnswer: "ÊïèÊç∑", englishExplanation: "`Êïè` (m«ên) relates to being quick and sharp. `ÊïèÊç∑` (m«ên ji√©) means agile or nimble, describing quick and clever actions." },
            { id: 'c1q20', question: "Ëøô‰ª∂Ë°£ÊúçÁöÑÔºà ÔºâÈáèÂæàÂ•ΩÔºåÁ©ø‰∫ÜÂæà‰πÖÈÉΩÊ≤°ÊúâÂùè„ÄÇ", options: ["Ë¥®", "Êï∞", "Èáç"], correctAnswer: "Ë¥®", englishExplanation: "`Ë¥®` (zh√¨) relates to quality. `Ë¥®Èáè` (zh√¨ li√†ng) is the word for 'quality'." }
        ],
        "Á¨¨‰∫åÁªÑÔºöËØçËØ≠Â∫îÁî® (Medium)": [
            { id: 'c2q1', question: "ÁúãÂà∞Ëøô‰∏™Â•ΩÊ∂àÊÅØÔºåÂ§ßÂÆ∂ËÑ∏‰∏äÈÉΩÔºà ÔºâÂá∫‰∫ÜÁ¨ëÂÆπ„ÄÇ", options: ["ÈÄèÈú≤", "ÁâµÂä®", "Ê®°‰ªø"], correctAnswer: "ÈÄèÈú≤", correctSentence: [{word:'Â§ßÂÆ∂', pinyin:'d√† jiƒÅ'}, {word:'ËÑ∏‰∏ä', pinyin:'li«én sh√†ng'}, {word:'ÈÉΩ', pinyin:'d≈çu'}, {word:'ÈÄèÈú≤', pinyin:'t√≤u l√π'}, {word:'Âá∫', pinyin:'ch≈´'}, {word:'‰∫Ü', pinyin:'le'}, {word:'Á¨ëÂÆπ', pinyin:'xi√†o r√≥ng'}], englishExplanation: "`ÈÄèÈú≤` (t√≤u l√π) means to reveal or let show. Here, it describes smiles naturally appearing on everyone's faces." },
            { id: 'c2q2', question: "Â¶àÂ¶àÂÅöÁöÑÁÇ∏È∏°ÂèàÈ¶ôÂèàÔºà ÔºâÔºåÊàëÊúÄÂñúÊ¨¢ÂêÉ‰∫Ü„ÄÇ", options: ["Á°¨", "ËÑÜ", "ÈÖ∏"], correctAnswer: "ËÑÜ", correctSentence: [{word:'Â¶àÂ¶à', pinyin:'mƒÅ ma'}, {word:'ÂÅöÁöÑ', pinyin:'zu√≤ de'}, {word:'ÁÇ∏È∏°', pinyin:'zh√° jƒ´'}, {word:'ÂèàÈ¶ôÂèàËÑÜ', pinyin:'y√≤u xiƒÅng y√≤u cu√¨'}], englishExplanation: "The phrase `ÂèàÈ¶ôÂèàËÑÜ` (y√≤u xiƒÅng y√≤u cu√¨) means 'both fragrant and crispy', a common and positive way to describe delicious food like fried chicken." },
            { id: 'c2q3', question: "‰∏∫‰∫Ü‰π∞Âà∞ÈÇ£‰ª∂ÈôêÈáèÁâàÁöÑÁé©ÂÖ∑ÔºåÂì•Âì•‰∏ÄÂ§ßÊó©Â∞±ÂéªÂïÜÂ∫óÔºà Ôºâ‰∫Ü„ÄÇ", options: ["ÊèíÈòü", "ÊéíÈòü", "Êå§Èòü"], correctAnswer: "ÊéíÈòü", correctSentence: [{word:'Âì•Âì•', pinyin:'gƒì ge'}, {word:'Âéª', pinyin:'q√π'}, {word:'ÂïÜÂ∫ó', pinyin:'shƒÅng di√†n'}, {word:'ÊéíÈòü', pinyin:'p√°i du√¨'}, {word:'‰∫Ü', pinyin:'le'}], englishExplanation: "`ÊéíÈòü` (p√°i du√¨) means to queue up or stand in line, which is the proper behavior. `ÊèíÈòü` (chƒÅ du√¨) means to cut in line." },
            { id: 'c2q4', question: "ËøôÂÆ∂ÂïÜÂ∫óÁöÑÂïÜÂìÅÔºà ÔºâÂæàÂÖ¨ÈÅìÔºåÂõ†Ê≠§Âê∏Âºï‰∫ÜÂæàÂ§öÈ°æÂÆ¢„ÄÇ", options: ["‰ª∑Ê†º", "‰ª∑ÂÄº", "ÂÅáË¥ß"], correctAnswer: "‰ª∑Ê†º", correctSentence: [{word:'ËøôÂÆ∂', pinyin:'zh√® jiƒÅ'}, {word:'ÂïÜÂ∫óÁöÑ', pinyin:'shƒÅng di√†n de'}, {word:'ÂïÜÂìÅ', pinyin:'shƒÅng p«ên'}, {word:'‰ª∑Ê†º', pinyin:'ji√† g√©'}, {word:'Âæà', pinyin:'hƒõn'}, {word:'ÂÖ¨ÈÅì', pinyin:'g≈çng dao'}], englishExplanation: "`‰ª∑Ê†º` (ji√† g√©) means 'price'. `ÂÖ¨ÈÅì` (g≈çng dao) means fair or reasonable. So, 'the price is reasonable'." },
            { id: 'c2q5', question: "‰ªñÂõ†‰∏∫‰∏çËÇØÊâøËÆ§ÈîôËØØÔºåÊâÄ‰ª•ÂèóÂà∞‰∫ÜËÄÅÂ∏àÁöÑÔºà Ôºâ„ÄÇ", options: ["ÊÉ©ÁΩö", "Â•ñÂä±", "Ë°®Êâ¨"], correctAnswer: "ÊÉ©ÁΩö", correctSentence: [{word:'‰ªñ', pinyin:'tƒÅ'}, {word:'ÂèóÂà∞‰∫Ü', pinyin:'sh√≤u d√†o le'}, {word:'ËÄÅÂ∏àÁöÑ', pinyin:'l«éo shƒ´ de'}, {word:'ÊÉ©ÁΩö', pinyin:'ch√©ng f√°'}], englishExplanation: "`ÊÉ©ÁΩö` (ch√©ng f√°) means 'punishment', which is the consequence of not admitting a mistake. `Â•ñÂä±` (ji«éng l√¨) is a reward." },
            { id: 'c2q6', question: "Ê∂àÈò≤ÂëòÔºà ÔºâÂú∞ÂÜ≤ËøõÁÅ´Âú∫Êïë‰∫∫ÔºåÂ§ßÂÆ∂ÈÉΩÈùûÂ∏∏Êï¨‰Ω©‰ªñ‰ª¨„ÄÇ", options: ["ÂãáÊï¢", "ÂÆ≥ÊÄï", "ËÉÜÂ∞è"], correctAnswer: "ÂãáÊï¢", correctSentence: [{word:'Ê∂àÈò≤Âëò', pinyin:'xiƒÅo f√°ng yu√°n'}, {word:'ÂãáÊï¢Âú∞', pinyin:'y«íng g«én de'}, {word:'ÂÜ≤Ëøõ', pinyin:'ch≈çng j√¨n'}, {word:'ÁÅ´Âú∫', pinyin:'hu«í ch«éng'}], englishExplanation: "`ÂãáÊï¢` (y«íng g«én) means 'brave' or 'courageous', which accurately describes a firefighter's actions." },
            { id: 'c2q7', question: "Âú®ËøôÊ¨°ÁöÑÊØîËµõ‰∏≠ÔºåÊàë‰ª¨Áè≠Ôºà Ôºâ‰∫ÜÂÜ†ÂÜõ„ÄÇ", options: ["Ëµ¢Âæó", "ËæìÊéâ", "Â§±Âéª"], correctAnswer: "Ëµ¢Âæó", correctSentence: [{word:'Êàë‰ª¨Áè≠', pinyin:'w«í men bƒÅn'}, {word:'Ëµ¢Âæó', pinyin:'y√≠ng d√©'}, {word:'‰∫Ü', pinyin:'le'}, {word:'ÂÜ†ÂÜõ', pinyin:'gu√†n j≈´n'}], englishExplanation: "`Ëµ¢Âæó` (y√≠ng d√©) means to win something (like a prize or a title) through effort. `ÂÜ†ÂÜõ` (gu√†n j≈´n) means 'champion'." },
            { id: 'c2q8', question: "ËøáÈ©¨Ë∑ØÊó∂ÔºåÊàë‰ª¨Â∫îËØ•Ôºà Ôºâ‰∫§ÈÄöËßÑÂàô„ÄÇ", options: ["ÈÅµÂÆà", "ËøùÂèç", "ÂøΩÁï•"], correctAnswer: "ÈÅµÂÆà", correctSentence: [{word:'Êàë‰ª¨', pinyin:'w«í men'}, {word:'Â∫îËØ•', pinyin:'yƒ´ng gƒÅi'}, {word:'ÈÅµÂÆà', pinyin:'z≈´n sh«íu'}, {word:'‰∫§ÈÄöËßÑÂàô', pinyin:'jiƒÅo t≈çng guƒ´ z√©'}], englishExplanation: "`ÈÅµÂÆà` (z≈´n sh«íu) means to abide by or to comply with. You must abide by traffic rules for safety." },
            { id: 'c2q9', question: "Âê¨‰∫ÜÁà∑Áà∑ËÆ≤ÁöÑÊïÖ‰∫ãÔºåÊàëÂøÉÈáåÁöÑÔºà ÔºâÂÖ®ÈÉΩÊ∂àÂ§±‰∫Ü„ÄÇ", options: ["ÁñëÊÉë", "ÈóÆÈ¢ò", "È∫ªÁÉ¶"], correctAnswer: "ÁñëÊÉë", correctSentence: [{word:'Êàë', pinyin:'w«í'}, {word:'ÂøÉÈáåÁöÑ', pinyin:'xƒ´n l«ê de'}, {word:'ÁñëÊÉë', pinyin:'y√≠ hu√≤'}, {word:'ÂÖ®ÈÉΩ', pinyin:'qu√°n d≈çu'}, {word:'Ê∂àÂ§±‰∫Ü', pinyin:'xiƒÅo shƒ´ le'}], englishExplanation: "`ÁñëÊÉë` (y√≠ hu√≤) refers to a feeling of doubt or confusion. It's an internal feeling that can be cleared up by an explanation or story." },
            { id: 'c2q10', question: "Â§ñÈù¢‰∏ãÁùÄÂÄæÁõÜÂ§ßÈõ®ÔºåË∑Ø‰∫∫Âè™Â•ΩÊöÇÊó∂Ôºà ÔºâÂú®Â±ãÊ™ê‰∏ã„ÄÇ", options: ["Ë∫≤ÈÅø", "ÈöêËóè", "Â•îË∑ë"], correctAnswer: "Ë∫≤ÈÅø", correctSentence: [{word:'Ë∑Ø‰∫∫', pinyin:'l√π r√©n'}, {word:'Âè™Â•Ω', pinyin:'zh«ê h«éo'}, {word:'ÊöÇÊó∂', pinyin:'z√†n sh√≠'}, {word:'Ë∫≤ÈÅø', pinyin:'du«í b√¨'}, {word:'Âú®', pinyin:'z√†i'}, {word:'Â±ãÊ™ê‰∏ã', pinyin:'w≈´ y√°n xi√†'}], englishExplanation: "`Ë∫≤ÈÅø` (du«í b√¨) means to take shelter or to dodge. Here it means to take shelter from the heavy rain." },
            { id: 'c2q11', question: "ÂåªÁîü‰ªîÁªÜÂú∞‰∏∫ÁóÖ‰∫∫Ôºà ÔºâÔºåÂ∏åÊúõËÉΩÊâæÂá∫ÁóÖÂõ†„ÄÇ", options: ["Ê£ÄÊü•", "Ê≤ªÁñó", "ÁúãÊúõ"], correctAnswer: "Ê£ÄÊü•", correctSentence: [{word:'ÂåªÁîü', pinyin:'yƒ´ shƒìng'}, {word:'‰ªîÁªÜÂú∞', pinyin:'z«ê x√¨ de'}, {word:'‰∏∫', pinyin:'w√®i'}, {word:'ÁóÖ‰∫∫', pinyin:'b√¨ng r√©n'}, {word:'Ê£ÄÊü•', pinyin:'ji«én ch√°'}], englishExplanation: "`Ê£ÄÊü•` (ji«én ch√°) means to examine or check. A doctor first examines a patient to find the cause of illness before treating them." },
            { id: 'c2q12', question: "Êàë‰ª¨Ë¶ÅÂÖªÊàêÔºà ÔºâÁöÑÂ•Ω‰π†ÊÉØÔºå‰∏çÊµ™Ë¥πËµÑÊ∫ê„ÄÇ", options: ["Âã§Âä≥", "Âã§Âø´", "Âã§‰ø≠"], correctAnswer: "Âã§‰ø≠", correctSentence: [{word:'Êàë‰ª¨', pinyin:'w«í men'}, {word:'Ë¶Å', pinyin:'y√†o'}, {word:'ÂÖªÊàê', pinyin:'y«éng ch√©ng'}, {word:'Âã§‰ø≠', pinyin:'q√≠n ji«én'}, {word:'ÁöÑ', pinyin:'de'}, {word:'Â•Ω‰π†ÊÉØ', pinyin:'h«éo x√≠ gu√†n'}], englishExplanation: "`Âã§‰ø≠` (q√≠n ji«én) means both hardworking and thrifty/frugal. It's about being diligent and not wasteful, which fits the context perfectly." },
            { id: 'c2q13', question: "‰ªñÊòØ‰∏™Ôºà ÔºâÁöÑÂ≠©Â≠êÔºå‰ªé‰∏çËØ¥Ë∞é„ÄÇ", options: ["ËØöÂÆû", "ËôöÂÅá", "Áã°Áåæ"], correctAnswer: "ËØöÂÆû", correctSentence: [{word:'‰ªñ', pinyin:'tƒÅ'}, {word:'ÊòØ‰∏™', pinyin:'sh√¨ ge'}, {word:'ËØöÂÆû', pinyin:'ch√©ng sh√≠'}, {word:'ÁöÑ', pinyin:'de'}, {word:'Â≠©Â≠ê', pinyin:'h√°i zi'}], englishExplanation: "`ËØöÂÆû` (ch√©ng sh√≠) means honest. The clue is `‰ªé‰∏çËØ¥Ë∞é` (c√≥ng b√π shu≈ç hu«éng), which means 'never tells lies'." },
            { id: 'c2q14', question: "ÂßêÂßêÁöÑÈí¢Áê¥Ë°®ÊºîÈùûÂ∏∏Ôºà ÔºâÔºåËé∑Âæó‰∫ÜËßÇ‰ºóÁÉ≠ÁÉàÁöÑÊéåÂ£∞„ÄÇ", options: ["ÊàêÂäü", "ËÉúÂà©", "ÂÆåÊàê"], correctAnswer: "ÊàêÂäü", correctSentence: [{word:'ÂßêÂßêÁöÑ', pinyin:'jiƒõ jie de'}, {word:'Ë°®Êºî', pinyin:'bi«éo y«én'}, {word:'ÈùûÂ∏∏', pinyin:'fƒìi ch√°ng'}, {word:'ÊàêÂäü', pinyin:'ch√©ng g≈çng'}], englishExplanation: "`ÊàêÂäü` (ch√©ng g≈çng) means successful. It's used to describe an event or performance that went very well. `ËÉúÂà©` (sh√®ng l√¨) usually refers to victory in a competition." },
            { id: 'c2q15', question: "‰∏∫‰∫Ü‰øùÊä§ÁéØÂ¢ÉÔºåÊàë‰ª¨Â∫îËØ•Ôºà Ôºâ‰ΩøÁî®Â°ëÊñôË¢ã„ÄÇ", options: ["Â¢ûÂä†", "ÂáèÂ∞ë", "ÂÅúÊ≠¢"], correctAnswer: "ÂáèÂ∞ë", correctSentence: [{word:'Êàë‰ª¨', pinyin:'w«í men'}, {word:'Â∫îËØ•', pinyin:'yƒ´ng gƒÅi'}, {word:'ÂáèÂ∞ë', pinyin:'ji«én sh«éo'}, {word:'‰ΩøÁî®', pinyin:'sh«ê y√≤ng'}, {word:'Â°ëÊñôË¢ã', pinyin:'s√π li√†o d√†i'}], englishExplanation: "`ÂáèÂ∞ë` (ji«én sh«éo) means to reduce or decrease. Reducing the use of plastic bags is a key step in protecting the environment." },
            { id: 'c2q16', question: "‰ªñÂú®Âè∞‰∏äÊºîËÆ≤Êó∂Êúâ‰∫õÔºà ÔºâÔºåËØ¥ËØùÊúâÁÇπÂèëÊäñ„ÄÇ", options: ["Á¥ßÂº†", "ÂÖ¥Â•ã", "ÊøÄÂä®"], correctAnswer: "Á¥ßÂº†", correctSentence: [{word:'‰ªñ', pinyin:'tƒÅ'}, {word:'Âú®Âè∞‰∏ä', pinyin:'z√†i t√°i sh√†ng'}, {word:'Êúâ‰∫õ', pinyin:'y«íu xiƒì'}, {word:'Á¥ßÂº†', pinyin:'j«ên zhƒÅng'}], englishExplanation: "`Á¥ßÂº†` (j«ên zhƒÅng) means nervous. The clue is `ËØ¥ËØùÊúâÁÇπÂèëÊäñ` (shu≈ç hu√† y√≥u di«én fƒÅ d«íu) - 'voice was trembling a little'." },
            { id: 'c2q17', question: "ËøôÊ¨°ÊóÖË°åÔºåÊàë‰ª¨Ôºà Ôºâ‰∫ÜÂæàÂ§öÁæé‰∏ΩÁöÑÁÖßÁâá„ÄÇ", options: ["ÊãçÊëÑ", "ÊãçÁÖß", "ÊãçÊâì"], correctAnswer: "ÊãçÊëÑ", correctSentence: [{word:'Êàë‰ª¨', pinyin:'w«í men'}, {word:'ÊãçÊëÑ', pinyin:'pƒÅi sh√®'}, {word:'‰∫Ü', pinyin:'le'}, {word:'ÂæàÂ§ö', pinyin:'hƒõn du≈ç'}, {word:'Áæé‰∏ΩÁöÑÁÖßÁâá', pinyin:'mƒõi l√¨ de zh√†o pi√†n'}], englishExplanation: "`ÊãçÊëÑ` (pƒÅi sh√®) means to film or to shoot a photo/video. It's a slightly more formal term than `ÊãçÁÖß` (pƒÅi zh√†o) and fits well here." },
            { id: 'c2q18', question: "‰ªñÔºà ÔºâÂú∞ÊçÇ‰ΩèËÄ≥ÊúµÔºå‰∏çÊÉ≥Âê¨‰ªª‰ΩïÂô™Èü≥„ÄÇ", options: ["ËøÖÈÄü", "ÁºìÊÖ¢", "Ê∏êÊ∏ê"], correctAnswer: "ËøÖÈÄü", correctSentence: [{word:'‰ªñ', pinyin:'tƒÅ'}, {word:'ËøÖÈÄüÂú∞', pinyin:'x√πn s√π de'}, {word:'ÊçÇ‰Ωè', pinyin:'w«î zh√π'}, {word:'ËÄ≥Êúµ', pinyin:'ƒõr duo'}], englishExplanation: "`ËøÖÈÄü` (x√πn s√π) means rapidly or swiftly. This word describes the quick action of covering one's ears to block out noise." },
            { id: 'c2q19', question: "‰ªñ‰∏∫‰∫∫Ôºà ÔºâÔºå‰ªé‰∏çÂíåÈÇªÂ±ÖÂèëÁîü‰∫âÂêµ„ÄÇ", options: ["ÂíåÁ••", "ÊÖàÁ••", "Á••Âíå"], correctAnswer: "Á••Âíå", correctSentence: [{word:'‰ªñ', pinyin:'tƒÅ'}, {word:'‰∏∫‰∫∫', pinyin:'w√©i r√©n'}, {word:'Á••Âíå', pinyin:'xi√°ng h√©'}], englishExplanation: "`Á••Âíå` (xi√°ng h√©) describes a person's temperament as peaceful and amiable. `ÊÖàÁ••` (c√≠ xi√°ng) is usually used for kind, elderly people." },
            { id: 'c2q20', question: "Èù¢ÂØπÂõ∞ÈöæÔºåÊàë‰ª¨‰∏çËÉΩÔºà ÔºâÂ∏åÊúõ„ÄÇ", options: ["ÊîæÂºÉ", "ÊîæÊâã", "Êîæ‰∏ã"], correctAnswer: "ÊîæÂºÉ", correctSentence: [{word:'Êàë‰ª¨', pinyin:'w«í men'}, {word:'‰∏çËÉΩ', pinyin:'b√π n√©ng'}, {word:'ÊîæÂºÉ', pinyin:'f√†ng q√¨'}, {word:'Â∏åÊúõ', pinyin:'xƒ´ w√†ng'}], englishExplanation: "`ÊîæÂºÉ` (f√†ng q√¨) means to give up. The phrase `ÊîæÂºÉÂ∏åÊúõ` (f√†ng q√¨ xƒ´ w√†ng) means 'to give up hope'." }
        ],
        "Á¨¨‰∏âÁªÑÔºöËæ®Â≠ó‰∏éÁêÜËß£ (Hard)": [
            { id: 'c3q1', question: "ÂºüÂºü‰∏çÂ∞èÂøÉÊääÈÇªÂ±ÖÂÆ∂ÁöÑÁ™óÊà∑Ôºà ÔºâÁ†¥‰∫Ü„ÄÇ", options: ["ÊùÇ", "Á†∏", "Âåù"], correctAnswer: "Á†∏", correctSentence: [{word:'ÂºüÂºü', pinyin:'d√¨ di'}, {word:'Êää', pinyin:'b«é'}, {word:'Á™óÊà∑', pinyin:'chuƒÅng hu'}, {word:'Á†∏Á†¥‰∫Ü', pinyin:'z√° p√≤ le'}], englishExplanation: "`Á†∏` (z√°) means to smash or to pound. It's the correct character for breaking a window. `ÊùÇ` (z√°) means miscellaneous." },
            { id: 'c3q2', question: "ÁúãÂà∞ÂºüÂºüÈ°ΩÁöÆÁöÑÔºà ÔºâÂ≠êÔºåÂ¶àÂ¶àÂèàÂ•ΩÊ∞îÂèàÂ•ΩÁ¨ë„ÄÇ", options: ["Ê®°", "Êë∏", "ËÜú"], correctAnswer: "Ê®°", correctSentence: [{word:'ÁúãÂà∞', pinyin:'k√†n d√†o'}, {word:'ÂºüÂºü', pinyin:'d√¨ di'}, {word:'È°ΩÁöÆÁöÑ', pinyin:'w√°n p√≠ de'}, {word:'Ê†∑Â≠ê', pinyin:'y√†ng zi'}], englishExplanation: "The word is `Ê†∑Â≠ê` (y√†ng zi), meaning appearance or look. The character is `Ê†∑` but it uses the `Ê®°` from `Ê®°Ê†∑` (m√∫ y√†ng) as a distractor here. You chose the root component `Ê®°`. `Êë∏` (m≈ç) means to touch." },
            { id: 'c3q3', question: "Êàë‰ª¨Ë¶ÅÂàÜÔºà ÔºâÊòØÈùûÔºåÂÅö‰∏Ä‰∏™Ê≠£Áõ¥ÁöÑ‰∫∫„ÄÇ", options: ["Ëæ®", "Ëæ©", "Ëæ´"], correctAnswer: "Ëæ®", correctSentence: [{word:'Êàë‰ª¨', pinyin:'w«í men'}, {word:'Ë¶Å', pinyin:'y√†o'}, {word:'ÂàÜËæ®', pinyin:'fƒìn bi√†n'}, {word:'ÊòØÈùû', pinyin:'sh√¨ fƒìi'}], englishExplanation: "`ÂàÜËæ®` (fƒìn bi√†n) means to distinguish or differentiate. `Ëæ©` (bi√†n) is for debate (`Ëæ©ËÆ∫`). `Ëæ´` (bi√†n) is for braids (`Ëæ´Â≠ê`)." },
            { id: 'c3q4', question: "ËôΩÁÑ∂‰ªñÂÆ∂Â¢É‰∏çÂØåË£ïÔºå‰ΩÜ‰ªñ‰ªé‰∏çÔºà ÔºâÊÖïÂà´‰∫∫ÁöÑÁîüÊ¥ª„ÄÇ", options: ["Áæ°", "Â´å", "Ê≠â"], correctAnswer: "Áæ°", correctSentence: [{word:'‰ªñ', pinyin:'tƒÅ'}, {word:'‰ªé‰∏ç', pinyin:'c√≥ng b√π'}, {word:'Áæ°ÊÖï', pinyin:'xi√†n m√π'}, {word:'Âà´‰∫∫', pinyin:'bi√© r√©n'}], englishExplanation: "The word is `Áæ°ÊÖï` (xi√†n m√π), which means to envy or admire. `Â´å` (xi√°n) means to dislike or complain about." },
            { id: 'c3q5', question: "‰ªñÔºà ÔºâÁùÄ‰∏ÄËÇ°‰∏çÊúçËæìÁöÑÂä≤ÂÑøÔºåÂàªËã¶ÁªÉ‰π†ÔºåÁªà‰∫éÂèñÂæó‰∫ÜËøõÊ≠•„ÄÇ", options: ["Âá≠", "‰ªª", "Âù™"], correctAnswer: "Âá≠", correctSentence: [{word:'‰ªñ', pinyin:'tƒÅ'}, {word:'Âá≠ÁùÄ', pinyin:'p√≠ng zhe'}, {word:'‰∏ÄËÇ°', pinyin:'y√¨ g«î'}, {word:'‰∏çÊúçËæìÁöÑÂä≤ÂÑø', pinyin:'b√π f√∫ sh≈´ de j√¨nr'}], englishExplanation: "`Âá≠ÁùÄ` (p√≠ng zhe) means to rely on or to depend on. He relied on his unyielding spirit to succeed." },
            { id: 'c3q6', question: "ËøôÊ¨°ËÄÉËØïÁöÑËåÉÂõ¥ÂæàÔºà ÔºâÔºåÊàë‰ª¨Ë¶ÅÂ•ΩÂ•ΩÂ§ç‰π†„ÄÇ", options: ["Âπø", "ÂéÇ", "Áä∑"], correctAnswer: "Âπø", correctSentence: [{word:'ËÄÉËØï', pinyin:'k«éo sh√¨'}, {word:'ÁöÑ', pinyin:'de'}, {word:'ËåÉÂõ¥', pinyin:'f√†n w√©i'}, {word:'Âæà', pinyin:'hƒõn'}, {word:'Âπø', pinyin:'gu«éng'}], englishExplanation: "`Âπø` (gu«éng) means wide or extensive. `ËåÉÂõ¥ÂæàÂπø` means the scope is very wide. `ÂéÇ` (ch«éng) means factory." },
            { id: 'c3q7', question: "ÂåªÁîüÊèêÈÜíÊàë‰ª¨Ë¶ÅÔºà ÔºâÊÑèÈ•ÆÈ£üÂç´ÁîüÔºåÈ¢ÑÈò≤ÁñæÁóÖ„ÄÇ", options: ["Ê≥®", "‰Ωè", "Êü±"], correctAnswer: "Ê≥®", correctSentence: [{word:'Êàë‰ª¨', pinyin:'w«í men'}, {word:'Ë¶Å', pinyin:'y√†o'}, {word:'Ê≥®ÊÑè', pinyin:'zh√π y√¨'}, {word:'È•ÆÈ£üÂç´Áîü', pinyin:'y«ên sh√≠ w√®i shƒìng'}], englishExplanation: "`Ê≥®ÊÑè` (zh√π y√¨) means to pay attention to. `‰Ωè` (zh√π) means to live. `Êü±` (zh√π) means pillar." },
            { id: 'c3q8', question: "Â¶àÂ¶àÊääÁ¢óÁ¢üÊï¥ÈΩêÂú∞ÊîæËøõÔºà ÔºâÊüúÈáå„ÄÇ", options: ["Âé®", "Ê©±", " ch√∫"], correctAnswer: "Ê©±", correctSentence: [{word:'Â¶àÂ¶à', pinyin:'mƒÅ ma'}, {word:'Êää', pinyin:'b«é'}, {word:'Á¢óÁ¢ü', pinyin:'w«én di√©'}, {word:'ÊîæËøõ', pinyin:'f√†ng j√¨n'}, {word:'Ê©±ÊüúÈáå', pinyin:'ch√∫ gu√¨ l«ê'}], englishExplanation: "`Ê©±Êüú` (ch√∫ gu√¨) is the word for a cupboard or cabinet. It has the 'wood' radical (Êú®). `Âé®Êàø` (ch√∫ f√°ng), kitchen, uses a different `Âé®`." },
            { id: 'c3q9', question: "‰ªñÂõ†‰∏∫Âú®ËÄÉËØï‰∏≠‰ΩúÔºà ÔºâÔºåË¢´ÂèñÊ∂à‰∫ÜÊàêÁª©„ÄÇ", options: ["Âºä", "Â∏Å", "Êïù"], correctAnswer: "Âºä", correctSentence: [{word:'‰ªñ', pinyin:'tƒÅ'}, {word:'Âú®', pinyin:'z√†i'}, {word:'ËÄÉËØï‰∏≠', pinyin:'k«éo sh√¨ zh≈çng'}, {word:'‰ΩúÂºä', pinyin:'zu√≤ b√¨'}], englishExplanation: "`‰ΩúÂºä` (zu√≤ b√¨) is the specific term for cheating in an exam. `Â∏Å` (b√¨) refers to currency." },
            { id: 'c3q10', question: "Êàë‰ª¨Ë¶ÅÁèçÊÉúÊó∂Èó¥Ôºå‰∏çË¶ÅÔºà ÔºâË¥πÂÖâÈò¥„ÄÇ", options: ["Êµ™", "ËâØ", "Áãº"], correctAnswer: "Êµ™", correctSentence: [{word:'Êàë‰ª¨', pinyin:'w«í men'}, {word:'Ë¶Å', pinyin:'y√†o'}, {word:'ÁèçÊÉúÊó∂Èó¥', pinyin:'zhƒìn xƒ´ sh√≠ jiƒÅn'}, {word:'‰∏çË¶Å', pinyin:'b√∫ y√†o'}, {word:'Êµ™Ë¥π', pinyin:'l√†ng f√®i'}, {word:'ÂÖâÈò¥', pinyin:'guƒÅng yƒ´n'}], englishExplanation: "`Êµ™Ë¥π` (l√†ng f√®i) means to waste. `ÂÖâÈò¥` (guƒÅng yƒ´n) is a literary term for time. So, 'do not waste time'." },
            { id: 'c3q11', question: "Ëøô‰ª∂Ë°£ÊúçÁöÑÔºà ÔºâÊñôÂæàËàíÊúçÔºåÁ©øÂú®Ë∫´‰∏äÂæàÂáâÂø´„ÄÇ", options: ["Êùê", "Êâç", "Ë¥¢"], correctAnswer: "Êùê", correctSentence: [{word:'Ëøô‰ª∂', pinyin:'zh√® ji√†n'}, {word:'Ë°£ÊúçÁöÑ', pinyin:'yƒ´ fu de'}, {word:'ÊùêÊñô', pinyin:'c√°i li√†o'}, {word:'Âæà', pinyin:'hƒõn'}, {word:'ËàíÊúç', pinyin:'sh≈´ fu'}], englishExplanation: "`ÊùêÊñô` (c√°i li√†o) means material or fabric. `Êâç` (c√°i) is for talent. `Ë¥¢` (c√°i) is for wealth." },
            { id: 'c3q12', question: "ËøôÊ¨°ÂçéÊñáÊµãÔºà ÔºâÁöÑÊàêÁª©ÔºåÊàëËøõÊ≠•‰∫ÜÂæàÂ§ö„ÄÇ", options: ["Êç°", "È™å", "Èô©"], correctAnswer: "È™å", correctSentence: [{word:'ËøôÊ¨°', pinyin:'zh√® c√¨'}, {word:'ÂçéÊñá', pinyin:'hu√° w√©n'}, {word:'ÊµãÈ™å', pinyin:'c√® y√†n'}, {word:'ÁöÑ', pinyin:'de'}, {word:'ÊàêÁª©', pinyin:'ch√©ng j√¨'}, {word:'ËøõÊ≠•‰∫Ü', pinyin:'j√¨n b√π le'}], englishExplanation: "`ÊµãÈ™å` (c√® y√†n) means test or quiz. `Êç°` (ji«én) means to pick up. `Èô©` (xi«én) means danger." },
            { id: 'c3q13', question: "Â§±Ë¥•Âπ∂‰∏çÂèØÊÄïÔºåÂèØÊÄïÁöÑÊòØÂ§±ÂéªÔºà ÔºâÊñóÁöÑÂãáÊ∞î„ÄÇ", options: ["Â•ã", "ÊÑ§", "‰ªΩ"], correctAnswer: "Â•ã", correctSentence: [{word:'ÂèØÊÄïÁöÑÊòØ', pinyin:'kƒõ p√† de sh√¨'}, {word:'Â§±Âéª', pinyin:'shƒ´ q√π'}, {word:'Â•ãÊñó', pinyin:'f√®n d√≤u'}, {word:'ÁöÑ', pinyin:'de'}, {word:'ÂãáÊ∞î', pinyin:'y«íng q√¨'}], englishExplanation: "`Â•ãÊñó` (f√®n d√≤u) means to struggle or to strive. It refers to the effort one puts in. `ÊÑ§` (f√®n) is for anger." },
            { id: 'c3q14', question: "Êàë‰ª¨Ë¶ÅÂ≠¶‰ºöÔºà ÔºâÂøÉÁ≠âÂæÖÔºå‰∏çË¶ÅÊÄ•Ë∫Å„ÄÇ", options: ["ËÄê", "Â•à", "n√†i"], correctAnswer: "ËÄê", correctSentence: [{word:'Êàë‰ª¨', pinyin:'w«í men'}, {word:'Ë¶Å', pinyin:'y√†o'}, {word:'Â≠¶‰ºö', pinyin:'xu√© hu√¨'}, {word:'ËÄêÂøÉ', pinyin:'n√†i xƒ´n'}, {word:'Á≠âÂæÖ', pinyin:'dƒõng d√†i'}], englishExplanation: "`ËÄêÂøÉ` (n√†i xƒ´n) is the word for patience. The character `ËÄê` means to endure or to be patient." },
            { id: 'c3q15', question: "‰ªñÔºà ÔºâÂÜ≥‰∏çÂêëÂõ∞Èöæ‰ΩéÂ§¥„ÄÇ", options: ["Âùö", "Áõë", "Ëâ∞"], correctAnswer: "Âùö", correctSentence: [{word:'‰ªñ', pinyin:'tƒÅ'}, {word:'ÂùöÂÜ≥', pinyin:'jiƒÅn ju√©'}, {word:'‰∏çÂêë', pinyin:'b√∫ xi√†ng'}, {word:'Âõ∞Èöæ', pinyin:'k√πn nan'}, {word:'‰ΩéÂ§¥', pinyin:'dƒ´ t√≥u'}], englishExplanation: "`ÂùöÂÜ≥` (jiƒÅn ju√©) means firmly or resolutely. It expresses a very strong determination." },
            { id: 'c3q16', question: "ËøôÈÅìÈ¢òÁöÑËß£È¢òÊ≠•Ôºà ÔºâÂæàÂ§çÊùÇ„ÄÇ", options: ["È™§", "ËÅö", "Âèñ"], correctAnswer: "È™§", correctSentence: [{word:'ËøôÈÅìÈ¢òÁöÑ', pinyin:'zh√® d√†o t√≠ de'}, {word:'Ëß£È¢ò', pinyin:'jiƒõ t√≠'}, {word:'Ê≠•È™§', pinyin:'b√π zh√≤u'}, {word:'ÂæàÂ§çÊùÇ', pinyin:'hƒõn f√π z√°'}], englishExplanation: "`Ê≠•È™§` (b√π zh√≤u) means steps or procedure. It refers to the sequence of actions needed to solve a problem." },
            { id: 'c3q17', question: "ÊàëÂÜõÂäøÂ¶ÇÁ†¥Á´πÔºå‰∏ÄÔºà ÔºâÂçÉÈáåÔºåÂæàÂø´Â∞±ÂèñÂæó‰∫ÜËÉúÂà©„ÄÇ", options: ["Ê≥Ñ", "Ê≥ª", "Âç∏"], correctAnswer: "Ê≥ª", correctSentence: [{word:'ÊàëÂÜõ', pinyin:'w«í j≈´n'}, {word:'ÂäøÂ¶ÇÁ†¥Á´π', pinyin:'sh√¨ r√∫ p√≤ zh√∫'}, {word:'‰∏ÄÊ≥ªÂçÉÈáå', pinyin:'yƒ´ xi√® qiƒÅn l«ê'}], englishExplanation: "The idiom is `‰∏ÄÊ≥ªÂçÉÈáå` (yƒ´ xi√® qiƒÅn l«ê), which means 'to rush down a thousand miles'. It describes something (like an army's advance) that is swift and unstoppable. Use `Ê≥ª` (xi√®)." },
            { id: 'c3q18', question: "‰ªñ‰∏çÂ∞èÂøÉÊääÂ¢®Ê∞¥ÂºÑÁøªÔºåÔºà ÔºâËÑè‰∫ÜÊñ∞‰π∞ÁöÑÁôΩË°¨Ë°´„ÄÇ", options: ["Ê±°", "‰∫è", "‰∫é"], correctAnswer: "Ê±°", correctSentence: [{word:'‰ªñ', pinyin:'tƒÅ'}, {word:'ÂºÑÁøª‰∫Ü', pinyin:'n√≤ng fƒÅn le'}, {word:'Â¢®Ê∞¥', pinyin:'m√≤ shu«ê'}, {word:'Ê±°ËÑè‰∫Ü', pinyin:'w≈´ zƒÅng le'}, {word:'ÁôΩË°¨Ë°´', pinyin:'b√°i ch√®n shƒÅn'}], englishExplanation: "`Ê±°` (w≈´) means dirt or to stain. The word `Ê±°ËÑè` (w≈´ zƒÅng) or `ÂºÑËÑè` (n√≤ng zƒÅng) means to make something dirty." },
            { id: 'c3q19', question: "‰ªñËøô‰∏™‰∫∫ÂæàÔºà ÔºâÁåæÔºå‰Ω†Ë∑ü‰ªñÊâì‰∫§ÈÅìË¶ÅÂ∞èÂøÉ„ÄÇ", options: ["Áã°", "ËæÉ", "Ê†°"], correctAnswer: "Áã°", correctSentence: [{word:'‰ªñËøô‰∏™‰∫∫', pinyin:'tƒÅ zh√® ge r√©n'}, {word:'Âæà', pinyin:'hƒõn'}, {word:'Áã°Áåæ', pinyin:'ji«éo hu√°'}], englishExplanation: "`Áã°Áåæ` (ji«éo hu√°) means cunning or crafty. It's a negative trait. `ËæÉ` (ji√†o) means to compare. `Ê†°` (xi√†o) means school." },
            { id: 'c3q20', question: "‰ªñËÆæËÆ°ÁöÑÂª∫Á≠ëÔºà ÔºâÂºèÊñ∞È¢ñÔºåËµ¢Âæó‰∫ÜËÆæËÆ°Â§ßÂ•ñ„ÄÇ", options: ["Ê†ºÂºè", "ÊñπÂºè", "ÂºèÊ†∑"], correctAnswer: "ÂºèÊ†∑", correctSentence: [{word:'‰ªñ', pinyin:'tƒÅ'}, {word:'ËÆæËÆ°ÁöÑ', pinyin:'sh√® j√¨ de'}, {word:'Âª∫Á≠ë', pinyin:'ji√†n zh√π'}, {word:'ÂºèÊ†∑', pinyin:'sh√¨ y√†ng'}, {word:'Êñ∞È¢ñ', pinyin:'xƒ´n y«êng'}], englishExplanation: "`ÂºèÊ†∑` (sh√¨ y√†ng) refers to the style or design of an object. `Ê†ºÂºè` (g√© sh√¨) is for format (like a document). `ÊñπÂºè` (fƒÅng sh√¨) is for method." }
        ]
    };

    // --- State Variables ---
    let currentSetData = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let incorrectAnswers = [];
    let startTime;
    let endTime;
    let isRedoing = false;
    let proceedTimeoutId = null;
    let isWaitingToProceed = false;
    let userName = localStorage.getItem(USER_NAME_STORAGE_KEY) || '';

    // --- Sound Synthesis (Tone.js) ---
    const correctSound = new Tone.Synth({ oscillator: { type: 'triangle' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.05, release: 0.2 }, }).toDestination();
    const incorrectSound = new Tone.Synth({ oscillator: { type: 'square' }, envelope: { attack: 0.01, decay: 0.2, sustain: 0, release: 0.2 } }).toDestination();

    // --- Confetti ---
    const confettiCanvas = document.getElementById('confettiCanvas');
    const myConfetti = confetti.create(confettiCanvas, { resize: true, useWorker: true });

    // --- DOM Elements ---
    const nameModal = document.getElementById('nameModal');
    const userNameInput = document.getElementById('userNameInput');
    const setSelectionScreen = document.getElementById('setSelectionScreen');
    const setButtonsContainer = document.getElementById('setButtonsContainer');
    const flashcardScreen = document.getElementById('flashcardScreen');
    const resultsScreen = document.getElementById('resultsScreen');
    const progressText = document.getElementById('progressText');
    const progressBarFill = document.getElementById('progressBarFill');
    const flashcard = document.getElementById('flashcard');
    const questionText = document.getElementById('questionText');
    const feedbackText = document.getElementById('feedbackText');
    const feedbackIconContainer = document.getElementById('feedbackIconContainer');
    const continueText = document.getElementById('continueText');
    const choiceButtons = [ document.getElementById('choice1'), document.getElementById('choice2'), document.getElementById('choice3') ];
    const scoreDisplayEl = document.getElementById('scoreDisplay');
    const percentageEl = document.getElementById('percentage');
    const timeTakenEl = document.getElementById('timeTaken');
    const incorrectListContainer = document.getElementById('incorrectListContainer');
    const incorrectList = document.getElementById('incorrectList');
    const noIncorrectText = document.getElementById('noIncorrectText');
    const redoIncorrectButton = document.getElementById('redoIncorrectButton');
    const encouragementTextEl = document.getElementById('encouragementText');
    const resultsHeadingEl = document.getElementById('resultsHeading');
    const raceTrackContainer = document.querySelector('#resultsScreen .race-track-container');
    const raceTrackFillEl = document.getElementById('raceTrackFill');
    const rocketEl = document.getElementById('rocketEl');

    // --- Event Listeners ---
    flashcard.addEventListener('click', () => {
        if (isWaitingToProceed &&
            !flashcard.classList.contains('incorrect-state') &&
            (flashcard.classList.contains('correct-state-static') || flashcard.classList.contains('clickable-card'))) {
            proceedToNext();
        }
    });
    userNameInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            event.preventDefault();
            saveUserName();
        }
    });

    // --- Utility Functions ---
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    // --- Core Application Logic ---
    function populateStartButton() {
        setButtonsContainer.innerHTML = '';
        Object.keys(allFlashcardSets).forEach(setName => {
            const set = allFlashcardSets[setName];
            if (set.length >= QUESTIONS_PER_SET) {
                const button = document.createElement('button');
                button.textContent = `ÂºÄÂßã ${setName}`;
                button.className = `action-button w-full py-3 px-6 bg-red-500 hover:bg-red-600 text-white mb-3 last:mb-0 text-lg`; 
                button.onclick = () => startFlashcardSession(set, setName);
                setButtonsContainer.appendChild(button);
            } else {
                const errorP = document.createElement('p');
                errorP.className = "text-red-500 text-sm";
                errorP.textContent = `Error: The set "${setName}" does not have enough questions (${set.length} found, ${QUESTIONS_PER_SET} required).`;
                setButtonsContainer.appendChild(errorP);
            }
        });
    }

    function saveUserName() {
        const name = userNameInput.value.trim();
        userName = name ? name : 'Â≠¶‰π†ËÄÖ';
        localStorage.setItem(USER_NAME_STORAGE_KEY, userName);
        nameModal.style.display = 'none';
        showSetSelection();
    }

    function startFlashcardSession(selectedSet, setName) {
        Tone.start().catch(e => console.warn("Audio context could not start:", e));
        
        // Add class for font styling if Set 2 or 3
        if (setName.includes("Á¨¨‰∫åÁªÑ") || setName.includes("Á¨¨‰∏âÁªÑ")) {
            flashcardScreen.classList.add('set23-text');
        } else {
            flashcardScreen.classList.remove('set23-text');
        }

        let fullSetCopy = [...selectedSet]; 
        shuffleArray(fullSetCopy);
        currentSetData = fullSetCopy.slice(0, QUESTIONS_PER_SET); 
        currentSetData.setName = setName; 
        currentQuestionIndex = 0;
        score = 0;
        incorrectAnswers = [];
        isRedoing = false;
        setSelectionScreen.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        flashcardScreen.classList.remove('hidden');
        updateProgress(); 
        startTime = new Date();
        displayQuestion();
    }

    function resetCardState() {
        if (proceedTimeoutId) { clearTimeout(proceedTimeoutId); proceedTimeoutId = null; }
        isWaitingToProceed = false;
        flashcard.classList.remove('shake', 'correct-state-static', 'incorrect-state', 'clickable-card');
        questionText.classList.remove('hidden');
        feedbackText.innerHTML = '';
        feedbackIconContainer.classList.add('hidden');
        continueText.classList.add('hidden');
        choiceButtons.forEach(btn => {
            btn.className = 'choice-button bg-slate-100 hover:bg-slate-200 text-slate-700';
            if (flashcardScreen.classList.contains('set23-text')) {
                btn.classList.add('text-xl');
            }
        });
    }

    function displayQuestion() {
        resetCardState();
        if (currentQuestionIndex >= currentSetData.length) {
            showResults();
            return;
        }
        const questionData = currentSetData[currentQuestionIndex];
        questionText.innerHTML = questionData.question.replace(/\n/g, '<br>');
        
        let displayOptions = [...questionData.options];
        shuffleArray(displayOptions);
        choiceButtons.forEach((button, index) => {
            if (displayOptions[index] !== undefined) {
                button.textContent = displayOptions[index];
                button.disabled = false;
                button.dataset.answer = displayOptions[index];
                button.onclick = () => checkAnswer(button);
                button.style.display = '';
            } else {
                button.style.display = 'none'; 
            }
        });
    }

    function updateProgress() {
        const totalQuestions = currentSetData.length;
        const completed = currentQuestionIndex;
        const progressPercentage = totalQuestions > 0 ? (completed / totalQuestions) * 100 : 0;
        progressText.textContent = `${completed} / ${totalQuestions}`;
        progressBarFill.style.width = `${progressPercentage}%`;
    }

    function checkAnswer(button) {
        Tone.start().catch(e => console.warn("Audio context failed:", e));
        if (isWaitingToProceed && !flashcard.classList.contains('incorrect-state')) return;
        const selectedAnswer = button.dataset.answer;
        const questionData = currentSetData[currentQuestionIndex];
        const correctAnswer = questionData.correctAnswer;
        choiceButtons.forEach(btn => btn.disabled = true);

        if (selectedAnswer === correctAnswer) {
            if (!isRedoing) score++;
            flashcard.classList.add('correct-state-static');
            feedbackIconContainer.innerHTML = '<span class="text-7xl md:text-8xl">‚úì</span>';
            feedbackIconContainer.classList.remove('hidden');
            questionText.classList.add('hidden');
            feedbackText.textContent = 'Ê≠£Á°Æ!';
            myConfetti({ particleCount: 120, spread: 80, origin: { y: 0.6 } });
            correctSound.triggerAttackRelease("G5", "8n", Tone.now());
            button.className = `choice-button bg-emerald-600 text-white ring-2 ring-emerald-800 shadow-md ${flashcardScreen.classList.contains('set23-text') ? 'text-xl' : ''}`;
            isWaitingToProceed = true;
            flashcard.classList.add('clickable-card');
            continueText.classList.remove('hidden');
            proceedTimeoutId = setTimeout(proceedToNext, AUTO_PROCEED_DELAY);
            currentQuestionIndex++; 
            updateProgress(); 
        } else {
            flashcard.classList.add('shake', 'incorrect-state');
            feedbackIconContainer.innerHTML = '<span class="text-7xl md:text-8xl">‚úó</span>';
            feedbackIconContainer.classList.remove('hidden');
            questionText.classList.add('hidden'); 
            
            // --- NEW Enhanced Feedback Generation ---
            let feedbackHTML = '';
            // Display sentence with pinyin if available
            if (questionData.correctSentence && Array.isArray(questionData.correctSentence)) {
                let sentenceHTML = '<div class="feedback-sentence-container">';
                questionData.correctSentence.forEach(item => {
                    sentenceHTML += `
                        <div class="feedback-word-group">
                            <div class="feedback-word">${item.word}</div>
                            <div class="feedback-pinyin">${item.pinyin}</div>
                        </div>
                    `;
                });
                sentenceHTML += '</div>';
                feedbackHTML += sentenceHTML;
            } else {
                // Fallback for Set 1 or if sentence is not provided
                 feedbackHTML += `<div>Ê≠£Á°ÆÁ≠îÊ°à: <span class="font-bold text-2xl">${correctAnswer}</span></div>`;
            }

            // Display English explanation
            if (questionData.englishExplanation) {
                feedbackHTML += `<div class="english-explanation">${questionData.englishExplanation}</div>`;
            }

            feedbackHTML += `<div class="prompt-guidance">ÁÇπÂáªÁªøËâ≤Ê≠£Á°ÆÁ≠îÊ°àÁªßÁª≠„ÄÇ</div>`;
            feedbackText.innerHTML = feedbackHTML;
            // --- End of Enhanced Feedback ---

            incorrectSound.triggerAttackRelease("C3", "8n");
            if (!isRedoing) {
                incorrectAnswers.push({ questionData: questionData, userAnswer: selectedAnswer });
            }
            isWaitingToProceed = false;
            flashcard.classList.remove('clickable-card');
            if (proceedTimeoutId) { clearTimeout(proceedTimeoutId); }
            choiceButtons.forEach(btn => {
                const baseClass = flashcardScreen.classList.contains('set23-text') ? 'text-xl' : '';
                if (btn.dataset.answer === correctAnswer) {
                    btn.className = `choice-button bg-emerald-500 hover:bg-emerald-600 text-white ${baseClass}`;
                    btn.disabled = false;
                    btn.onclick = function() {
                        currentQuestionIndex++; 
                        updateProgress(); 
                        proceedToNext();
                    };
                } else if (btn === button) {
                    btn.className = `choice-button bg-red-700 text-white ring-2 ring-red-900 shadow-md ${baseClass}`;
                } else {
                    btn.className = `choice-button bg-slate-200 text-slate-500 forced-disabled-look ${baseClass}`;
                }
            });
        }
    }

    function proceedToNext() {
        if (proceedTimeoutId) { clearTimeout(proceedTimeoutId); }
        isWaitingToProceed = false;
        displayQuestion();
    }

    function showResults() {
        endTime = new Date();
        const timeDiff = Math.round((endTime - startTime) / 1000);
        const totalQuestions = currentSetData.length;
        const currentScore = isRedoing ? (totalQuestions - incorrectAnswers.length) : score;
        const percentage = totalQuestions > 0 ? Math.round((currentScore / totalQuestions) * 100) : 0;

        resultsHeadingEl.textContent = isRedoing ? 'ÈîôÈ¢òÂ§ç‰π†ÂÆåÊàêÔºÅ' : `‚Äú${currentSetData.setName || 'ÁªÉ‰π†'}‚ÄùÂÆåÊàê!`;
        scoreDisplayEl.textContent = `${currentScore} / ${totalQuestions}`;
        percentageEl.textContent = `${percentage}`;
        timeTakenEl.textContent = `${timeDiff}`;

        if (percentage === 100) encouragementTextEl.textContent = "Â§™Ê£í‰∫ÜÔºåÊª°ÂàÜÔºÅ‰Ω†Â∑≤ÁªèÊéåÊè°‰∫ÜËøô‰∏™ÈÉ®ÂàÜÔºÅ";
        else if (percentage >= 70) encouragementTextEl.textContent = "ÂÅöÂæóÂæàÂ•ΩÔºÅÁªßÁª≠Âä™ÂäõÔºå‰Ω†ÈùûÂ∏∏Âá∫Ëâ≤„ÄÇ";
        else encouragementTextEl.textContent = "‰∏çÈîôÔºÅÂ§ç‰π†‰∏Ä‰∏ãÈîôÈ¢òÔºåÂèØ‰ª•ËÆ©‰Ω†Êõ¥Âº∫Â§ß„ÄÇ";
        
        flashcardScreen.classList.add('hidden');
        resultsScreen.classList.remove('hidden');
        
        requestAnimationFrame(() => {
            setTimeout(() => { 
                const trackWidth = raceTrackContainer.offsetWidth;
                const effectiveTrackWidth = trackWidth - rocketEl.offsetWidth; 
                const finalRocketPosition = Math.max(0, (percentage / 100) * effectiveTrackWidth);
                rocketEl.style.left = `${finalRocketPosition}px`;
                raceTrackFillEl.style.width = `${finalRocketPosition}px`;
            }, 100);
        });

        incorrectList.innerHTML = '';
        if (incorrectAnswers.length > 0) {
            incorrectListContainer.classList.remove('hidden'); noIncorrectText.classList.add('hidden');
            incorrectAnswers.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<b>ÈóÆÈ¢ò:</b> ${item.questionData.question.replace(/\n/g, ' ')}<br/><b>‰Ω†ÁöÑÁ≠îÊ°à:</b> <span class="text-red-500">${item.userAnswer}</span><br/><b>Ê≠£Á°ÆÁ≠îÊ°à:</b> <span class="text-emerald-600">${item.questionData.correctAnswer}</span>`;
                incorrectList.appendChild(li);
            });
            redoIncorrectButton.classList.remove('hidden');
            redoIncorrectButton.disabled = isRedoing || incorrectAnswers.length === 0;
        } else {
            incorrectListContainer.classList.add('hidden'); noIncorrectText.classList.remove('hidden');
            redoIncorrectButton.classList.add('hidden');
        }

        sendResultsToGoogleSheet({
            setName: currentSetData.setName || "Unknown Set", score: currentScore, totalQuestions: totalQuestions,
            percentage: percentage, timeTaken: timeDiff,
            incorrectAnswersJSON: JSON.stringify(incorrectAnswers.map(item => ({ q: item.questionData.question, u: item.userAnswer, c: item.questionData.correctAnswer }))),
            name: userName, timestamp: new Date().toISOString() 
        });

        if (isRedoing) { incorrectAnswers = []; isRedoing = false; }
    }

    function sendResultsToGoogleSheet(data) {
        fetch(APPS_SCRIPT_URL, {
            method: 'POST', mode: 'no-cors', 
            headers: { 'Content-Type': 'application/json' }, 
            body: JSON.stringify({payloadType: 'flashcardResults', ...data, subject: 'Chinese' })
        }).catch(err => console.error("Failed to send results:", err));
    }

    function redoIncorrect() {
        if (incorrectAnswers.length === 0) return;
        const originalSetName = currentSetData.setName.replace(" (ÈáçÂÅö)", "");
        currentSetData = incorrectAnswers.map(item => item.questionData);
        currentSetData.setName = `${originalSetName} (ÈáçÂÅö)`;
        currentQuestionIndex = 0;
        incorrectAnswers = []; 
        isRedoing = true;
        resultsScreen.classList.add('hidden');
        flashcardScreen.classList.remove('hidden');
        startTime = new Date();
        updateProgress(); 
        displayQuestion();
    }

    function showSetSelection() {
        if (proceedTimeoutId) { clearTimeout(proceedTimeoutId); }
        isWaitingToProceed = false; isRedoing = false; 
        nameModal.style.display = 'none';
        flashcardScreen.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        setSelectionScreen.classList.remove('hidden');
        populateStartButton();
    }

    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        userName = localStorage.getItem(USER_NAME_STORAGE_KEY) || '';
        if (userName) {
            showSetSelection(); 
        } else {
            nameModal.style.display = 'flex';
            userNameInput.focus();
        }
    });
</script>

</body>
</html>
