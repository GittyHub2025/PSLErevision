<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>PSLE 华文闪卡 (PSLE Chinese Flashcards)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            overscroll-behavior: none;
            -webkit-tap-highlight-color: transparent;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
            20%, 40%, 60%, 80% { transform: translateX(8px); }
        }
        .shake { animation: shake 0.5s ease-in-out; }

        .correct-state-static {
            background-color: #22c55e !important; /* green-500 */
            color: white !important;
        }
        .correct-state-static #questionText { display: none !important; }
        .correct-state-static #feedbackText,
        .correct-state-static #feedbackIconContainer { color: white !important; }

        .incorrect-state {
            background-color: #ef4444 !important; /* red-500 */
            color: white !important;
            border-color: #b91c1c !important; /* red-700 */
        }
        .incorrect-state #questionText { display: none !important; }
        .incorrect-state #feedbackText,
        .incorrect-state #feedbackIconContainer { color: white !important; }

        .annotated-sentence-container {
            font-size: 1.5rem;
            font-weight: 600;
            line-height: 2.5;
            margin-bottom: 1rem;
            color: white;
            background-color: rgba(0, 0, 0, 0.15);
            padding: 1rem;
            border-radius: 0.5rem;
        }
        .word-anno {
            display: inline-block;
            text-align: center;
            margin: 0 0.25rem;
            padding: 0 0.1rem;
        }
        .word-anno .pinyin {
            display: block;
            font-size: 0.9rem;
            font-weight: 400;
            color: #f0fdf4;
        }
        .english-explanation {
            font-style: italic;
            margin-top: 1rem;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
            font-weight: 500;
            color: white;
            padding: 0.5rem;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 0.375rem;
        }
        .explanation-box {
            font-size: 0.9rem;
            display: block;
            margin-top: 0.5rem;
            font-weight: normal;
            background-color: rgba(0, 0, 0, 0.1);
            padding: 0.5rem; border-radius: 0.375rem;
        }
        .prompt-guidance {
             font-size: 0.875rem; display: block; margin-top: 1rem; font-weight: bold;
        }

        .choice-button, .action-button {
            transition: all 0.2s ease-in-out;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            border-radius: 0.5rem; font-weight: 600;
            padding: 0.75rem 0.5rem; text-align: center;
            border: 1px solid transparent;
        }
        .choice-button:hover:not(:disabled), .action-button:hover {
            transform: translateY(-2px); box-shadow: 0 4px 8px rgba(0,0,0,0.12);
        }
        .choice-button:active:not(:disabled), .action-button:active {
            transform: translateY(0px); box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .choice-button:disabled { opacity: 0.7; cursor: not-allowed; transform: none; }
        .choice-button.forced-disabled-look { opacity: 0.5; }
        .choice-button:disabled:hover { transform: none; box-shadow: 0 2px 4px rgba(0,0,0,0.08); }

        .clickable-card { cursor: pointer; }
        #progressBarFill { transition: width 0.3s ease-out; }
        #confettiCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
        
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
        .modal-content { background-color: #fefefe; margin: auto; padding: 20px; border: 1px solid #888; width: 90%; max-width: 500px; border-radius: 0.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }

        .race-track-container { position: relative; width: 100%; height: 30px; margin-top: 20px; margin-bottom: 20px; z-index: 1; }
        .race-track { position: absolute; bottom: 0; left: 0; width: calc(100% - 30px); height: 10px; background-color: #d1d5db; border-radius: 5px; z-index: 2; }
        .race-track-fill { position: absolute; bottom: 0; left: 0; height: 10px; background-color: #3b82f6; border-radius: 5px; width: 0%; z-index: 3; transition: width 1.5s ease-out; }
        .rocket { position: absolute; bottom: -8px; left: 0; font-size: 36px; transform: translateX(-50%); z-index: 10; transition: left 1.5s ease-out; }
        .checkered-flag { position: absolute; bottom: -8px; right: 0; font-size: 24px; transform: translateX(50%); z-index: 10; }

        #questionText { word-break: break-word; hyphens: auto; }
        .choice-button { white-space: normal; word-break: break-word; line-height: 1.4; min-height: 60px; display: flex; align-items: center; justify-content: center; }
        
        #questionText { font-size: 1.75rem; }
        @media (min-width: 768px) { #questionText { font-size: 2rem; } }
        .choice-button { font-size: 1.125rem; }
        @media (min-width: 768px) { .choice-button { font-size: 1.25rem; } }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gradient-to-br from-green-100 via-teal-100 to-emerald-100 min-h-screen flex items-center justify-center p-4">

    <div id="appContainer" class="w-full max-w-md mx-auto">

        <!-- Name Input Modal -->
         <div id="nameModal" class="modal">
             <div class="modal-content text-center">
                 <h2 class="text-xl md:text-2xl font-semibold mb-4 text-teal-700">欢迎，华文学习者！</h2>
                 <p class="text-slate-600 mb-4">请输入你的名字，开始你的PSLE华文复习之旅。</p>
                 <input type="text" id="userNameInput" placeholder="你的名字" class="w-full p-2 border border-slate-300 rounded mb-4 focus:ring-teal-500 focus:border-teal-500 text-center text-lg">
                 <button onclick="saveUserName()" class="action-button bg-teal-500 hover:bg-teal-600 text-white w-full py-3 px-6 text-lg">开始学习！</button>
             </div>
         </div>

        <!-- Set Selection Screen -->
        <div id="setSelectionScreen" class="hidden bg-white p-6 md:p-8 rounded-xl shadow-lg text-center">
            <h1 class="text-2xl md:text-3xl font-bold text-teal-800 mb-2">PSLE 华文练习</h1>
            <p class="text-slate-600 mb-8">请选择一个题组来巩固你的知识！</p>
            <div id="setButtonsContainer" class="grid grid-cols-1 gap-4"></div>
        </div>

        <!-- Flashcard Screen -->
        <div id="flashcardScreen" class="hidden bg-white p-6 md:p-8 rounded-xl shadow-lg">
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-medium text-slate-600">进度</span>
                    <span id="progressText" class="text-sm font-medium text-teal-700">0 / 0</span> </div>
                <div class="w-full bg-slate-200 rounded-full h-2.5">
                    <div id="progressBarFill" class="bg-teal-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
            </div>
            <div id="flashcard" class="bg-white border border-slate-300 rounded-lg p-6 mb-6 text-center min-h-[200px] flex flex-col items-center justify-center transition-colors duration-300">
                 <div id="flashcardContent" class="w-full flex flex-col items-center justify-center">
                     <div id="feedbackIconContainer" class="hidden text-7xl md:text-8xl mb-2"></div>
                     <p id="questionText" class="font-semibold text-slate-800"></p>
                     <div id="feedbackText" class="mt-2 text-base md:text-lg font-semibold"></div>
                     <p id="continueText" class="mt-4 text-sm text-slate-500 hidden">点击卡片继续...</p>
                 </div>
            </div>
            <div id="answerChoices" class="grid grid-cols-1 gap-3 md:gap-4">
                <button id="choice1" class="choice-button bg-slate-100 hover:bg-slate-200 text-slate-700"></button>
                <button id="choice2" class="choice-button bg-slate-100 hover:bg-slate-200 text-slate-700"></button>
                <button id="choice3" class="choice-button bg-slate-100 hover:bg-slate-200 text-slate-700"></button>
            </div>
             <button onclick="showSetSelection()" class="action-button mt-6 bg-slate-500 hover:bg-slate-600 text-white w-full text-sm py-3 px-6">返回选题</button>
        </div>

        <!-- Results Screen -->
        <div id="resultsScreen" class="hidden bg-white p-6 md:p-8 rounded-xl shadow-lg text-center">
            <h2 id="resultsHeading" class="text-2xl md:text-3xl font-bold text-teal-700 mb-4"></h2>
            <div class="bg-emerald-500 text-white p-4 rounded-lg mb-6">
                <p class="text-lg md:text-xl font-semibold mb-1">你的分数:</p>
                <p id="scoreDisplay" class="text-4xl md:text-5xl font-bold italic"></p>
            </div>
            <div class="race-track-container">
                <div class="race-track"></div>
                <div id="raceTrackFill" class="race-track-fill bg-teal-500"></div>
                <span id="rocketEl" class="rocket">🚀</span>
                <span id="checkeredFlag" class="checkered-flag">🏁</span>
            </div>
            <p class="text-lg text-slate-700 mb-2">正确率: <span id="percentage" class="font-semibold"></span>%</p>
            <p class="text-lg text-slate-700 mb-6">用时: <span id="timeTaken" class="font-semibold"></span> 秒</p>
            <p id="encouragementText" class="text-lg text-teal-700 font-semibold mb-6"></p>
            <div id="incorrectListContainer" class="mb-6 text-left">
                <h3 class="text-xl font-semibold text-red-600 mb-3">复习错题:</h3>
                <ul id="incorrectList" class="list-disc list-inside space-y-2 text-slate-600 text-sm"></ul>
                 <p id="noIncorrectText" class="text-emerald-600 font-semibold hidden">太棒了，没有错题！</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <button id="redoIncorrectButton" onclick="redoIncorrect()" class="action-button bg-orange-500 hover:bg-orange-600 text-white w-full py-3 px-6">重做错题</button>
                <button onclick="showSetSelection()" class="action-button bg-teal-500 hover:bg-teal-600 text-white w-full py-3 px-6">选择其他题组</button>
            </div>
        </div>
    </div>
    <canvas id="confettiCanvas"></canvas>

   <script>
    // --- Configuration ---
    const QUESTIONS_PER_SET = 20;
    const AUTO_PROCEED_DELAY = 1800;
    const USER_NAME_STORAGE_KEY = 'psleChineseApp_v4_newlist2';
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwxl5mcaKKp3rXABfN6tMDqzUMCZ7eUTUt3LeoO8xFlwlSTuJqbOMY9vNxwSatucjec/exec';

    // --- NEW FLASHCARD SETS (Based on the third word list) ---
    const allFlashcardSets = {
        "第七组：词语认读 (Easy)": [
            { id: 'c7q1', question: "“坚持” 的拼音是什么？", options: ["jiān chí", "jiān cí", "jì chí"], correctAnswer: "jiān chí", explanation: "“坚持”(jiān chí) 的意思是坚决保持、维护或进行。", annotatedSentence: `<div class="word-anno">坚持<span class="pinyin">jiān chí</span></div>`, englishExplanation: "English: '坚' (jiān) means firm and '持' (chí) means to hold. Together, '坚持' (jiān chí) means to persist or persevere." },
            { id: 'c7q2', question: "“仿佛” 的意思是什么？", options: ["好像", "肯定", "绝对不"], correctAnswer: "好像", explanation: "“仿佛”(fǎng fú) 和“好像”(hǎo xiàng) 意思相近，都表示似乎、差不多。", annotatedSentence: `<div class="word-anno">仿佛<span class="pinyin">fǎng fú</span></div>`, englishExplanation: "English: '仿佛' (fǎng fú) is a more formal way of saying 'as if' or 'to seem like'. It's often interchangeable with '好像' (hǎo xiàng)." },
            { id: 'c7q3', question: "“矛盾” 的拼音是什么？", options: ["máo dùn", "máo tǔn", "mào dùn"], correctAnswer: "máo dùn", explanation: "“矛盾”(máo dùn) 比喻言语或行为自相抵触。", annotatedSentence: `<div class="word-anno">矛盾<span class="pinyin">máo dùn</span></div>`, englishExplanation: "English: From the story of a man selling a 'spear' (矛, máo) that can pierce anything and a 'shield' (盾, dùn) that can block anything, '矛盾' (máo dùn) means 'contradiction'." },
            { id: 'c7q4', question: "“严肃” 的意思是什么？", options: ["表情、态度等庄重，使人敬畏", "轻松愉快", "马虎随便"], correctAnswer: "表情、态度等庄重，使人敬畏", explanation: "“严肃”(yán sù) 形容神情、气氛或态度庄重，不随意。", annotatedSentence: `<div class="word-anno">严肃<span class="pinyin">yán sù</span></div>`, englishExplanation: "English: '严' (yán) means strict and '肃' (sù) means solemn. '严肃' (yán sù) means serious, solemn, or stern." },
            { id: 'c7q5', question: "“劳动” 的拼音是什么？", options: ["láo dòng", "náo dòng", "lǎo dòng"], correctAnswer: "láo dòng", explanation: "“劳动”(láo dòng) 指的是人类创造物质或精神财富的活动，通常指体力或脑力工作。", annotatedSentence: `<div class="word-anno">劳动<span class="pinyin">láo dòng</span></div>`, englishExplanation: "English: '劳' (láo) means labor and '动' (dòng) means to move or act. '劳动' (láo dòng) means labor or work." },
            { id: 'c7q6', question: "“家乡” 的意思是什么？", options: ["自己出生或长期居住的地方", "首都", "外国"], correctAnswer: "自己出生或长期居住的地方", explanation: "“家乡”(jiā xiāng) 指的是自己家庭世代居住或自己出生的地方。", annotatedSentence: `<div class="word-anno">家乡<span class="pinyin">jiā xiāng</span></div>`, englishExplanation: "English: '家' (jiā) means home and '乡' (xiāng) means village or countryside. '家乡' (jiā xiāng) means 'hometown'." },
            { id: 'c7q7', question: "“孝顺” 的拼音是什么？", options: ["xiào shùn", "xiào sùn", "jiào shùn"], correctAnswer: "xiào shùn", explanation: "“孝顺”(xiào shùn) 指的是尽心奉养父母，顺从父母的意愿。", annotatedSentence: `<div class="word-anno">孝顺<span class="pinyin">xiào shùn</span></div>`, englishExplanation: "English: '孝' (xiào) refers to filial piety and '顺' (shùn) means to obey. '孝顺' (xiào shùn) means to be a dutiful and obedient child to one's parents." },
            { id: 'c7q8', question: "“愤怒” 的意思是什么？", options: ["非常生气", "非常高兴", "非常害怕"], correctAnswer: "非常生气", explanation: "“愤怒”(fèn nù) 是指因极度不满而情绪激动，非常生气。", annotatedSentence: `<div class="word-anno">愤怒<span class="pinyin">fèn nù</span></div>`, englishExplanation: "English: Both '愤' (fèn) and '怒' (nù) mean anger. '愤怒' (fèn nù) is a strong word for 'fury' or 'rage'." },
            { id: 'c7q9', question: "“大概” 的拼音是什么？", options: ["dà gài", "dà kài", "tài gài"], correctAnswer: "dà gài", explanation: "“大概”(dà gài) 表示对数量、时间、情况等的大致估计，不精确。", annotatedSentence: `<div class="word-anno">大概<span class="pinyin">dà gài</span></div>`, englishExplanation: "English: '大' (dà) means big and '概' (gài) means general. '大概' (dà gài) means 'probably' or 'approximately'." },
            { id: 'c7q10', question: "“英雄” 的意思是什么？", options: ["才能、品格出众，令人敬佩的人", "普通人", "胆小的人"], correctAnswer: "才能、品格出众，令人敬佩的人", explanation: "“英雄”(yīng xióng) 指的是在才智、行为、品德方面非常杰出，做出重大贡献而为人所敬佩的人。", annotatedSentence: `<div class="word-anno">英雄<span class="pinyin">yīng xióng</span></div>`, englishExplanation: "English: '英' (yīng) and '雄' (xióng) both refer to outstanding or heroic individuals. '英雄' (yīng xióng) is the word for 'hero'." },
            { id: 'c7q11', question: "“烦恼” 的拼音是什么？", options: ["fán nǎo", "fán lǎo", "fǎn nǎo"], correctAnswer: "fán nǎo", explanation: "“烦恼”(fán nǎo) 指的是不顺心或不愉快的事情，让人发愁。", annotatedSentence: `<div class="word-anno">烦恼<span class="pinyin">fán nǎo</span></div>`, englishExplanation: "English: '烦' (fán) means annoyed and '恼' (nǎo) means vexed. '烦恼' (fán nǎo) means 'worries', 'troubles', or the feeling of being vexed." },
            { id: 'c7q12', question: "“诚恳” 的意思是什么？", options: ["态度真诚，不说假话", "态度随便", "态度骄傲"], correctAnswer: "态度真诚，不说假话", explanation: "“诚恳”(chéng kěn) 指的是态度真诚，有信用。", annotatedSentence: `<div class="word-anno">诚恳<span class="pinyin">chéng kěn</span></div>`, englishExplanation: "English: '诚' (chéng) means sincere and '恳' (kěn) means earnest. '诚恳' (chéng kěn) means sincere or heartfelt." },
            { id: 'c7q13', question: "“制造” 的拼音是什么？", options: ["zhì zào", "zhì cào", "shì zào"], correctAnswer: "zhì zào", explanation: "“制造”(zhì zào) 指的是用原材料加工成各种产品。", annotatedSentence: `<div class="word-anno">制造<span class="pinyin">zhì zào</span></div>`, englishExplanation: "English: '制' (zhì) means to make and '造' (zào) means to create. '制造' (zhì zào) is the word for 'to manufacture' or 'to make'." },
            { id: 'c7q14', question: "“尺寸” 的意思是什么？", options: ["物体的长短大小", "物体的颜色", "物体的重量"], correctAnswer: "物体的长短大小", explanation: "“尺寸”(chǐ cùn) 是指物体的大小或长短。", annotatedSentence: `<div class="word-anno">尺寸<span class="pinyin">chǐ cùn</span></div>`, englishExplanation: "English: '尺' (chǐ) and '寸' (cùn) are both traditional units of length. '尺寸' (chǐ cùn) is used to mean 'size' or 'dimensions'." },
            { id: 'c7q15', question: "“祝贺” 的拼音是什么？", options: ["zhù hè", "zù hè", "zhù hé"], correctAnswer: "zhù hè", explanation: "“祝贺”(zhù hè) 指的是对别人的喜事表示庆贺。", annotatedSentence: `<div class="word-anno">祝贺<span class="pinyin">zhù hè</span></div>`, englishExplanation: "English: '祝' (zhù) means to wish and '贺' (hè) means to congratulate. '祝贺' (zhù hè) means 'to congratulate'." },
            { id: 'c7q16', question: "“根据” 的意思是什么？", options: ["以...为基础", "反对", "猜测"], correctAnswer: "以...为基础", explanation: "“根据”(gēn jù) 指的是把某种事物作为言语或行动的基础。", annotatedSentence: `<div class="word-anno">根据<span class="pinyin">gēn jù</span></div>`, englishExplanation: "English: '根' (gēn) means root and '据' (jù) means evidence. '根据' (gēn jù) means 'according to' or 'based on'." },
            { id: 'c7q17', question: "“联系” 的拼音是什么？", options: ["lián xì", "lián jì", "lián xí"], correctAnswer: "lián xì", explanation: "“联系”(lián xì) 指的是互相之间发生关联或沟通。", annotatedSentence: `<div class="word-anno">联系<span class="pinyin">lián xì</span></div>`, englishExplanation: "English: '联' (lián) means to connect and '系' (xì) means to tie or system. '联系' (lián xì) means 'to contact' or 'connection'." },
            { id: 'c7q18', question: "“恐怕” 的意思是什么？", options: ["担心，害怕", "肯定，确定", "喜欢"], correctAnswer: "担心，害怕", explanation: "“恐怕”(kǒng pà) 表示担心或估计，害怕发生不好的事。", annotatedSentence: `<div class="word-anno">恐怕<span class="pinyin">kǒng pà</span></div>`, englishExplanation: "English: Both '恐' (kǒng) and '怕' (pà) mean 'to fear'. '恐怕' (kǒng pà) means 'I'm afraid that...' or 'perhaps', expressing a worried guess." },
            { id: 'c7q19', question: "“激动” 的拼音是什么？", options: ["jī dòng", "jī tòng", "qī dòng"], correctAnswer: "jī dòng", explanation: "“激动”(jī dòng) 指的是因受刺激而感情冲动。", annotatedSentence: `<div class="word-anno">激动<span class="pinyin">jī dòng</span></div>`, englishExplanation: "English: '激' (jī) means to arouse and '动' (dòng) means to move. '激动' (jī dòng) describes the feeling of being 'excited' or 'agitated'." },
            { id: 'c7q20', question: "“独特” 的意思是什么？", options: ["独有的，特别的", "普通的，常见的", "相同的"], correctAnswer: "独有的，特别的", explanation: "“独特”(dú tè) 指的是独一无二的，与众不同的。", annotatedSentence: `<div class="word-anno">独特<span class="pinyin">dú tè</span></div>`, englishExplanation: "English: '独' (dú) means alone/single and '特' (tè) means special. '独特' (dú tè) means 'unique' or 'distinctive'." }
        ],
        "第八组：词语应用 (Medium)": [
            { id: 'c8q1', question: "无论遇到什么困难，我们都要（ ）下去，不能轻易放弃。", options: ["坚持", "保持", "维持"], correctAnswer: "坚持", 
              explanation: "“坚持”(jiān chí) 强调意志坚定，不中途放弃。", 
              annotatedSentence: `<span class="word-anno">我们<span class="pinyin">wǒ men</span></span><span class="word-anno">要<span class="pinyin">yào</span></span><span class="word-anno">坚持<span class="pinyin">jiān chí</span></span><span class="word-anno">下去<span class="pinyin">xià qù</span></span>`, 
              englishExplanation: "English: '坚持' (jiān chí) means 'to persevere' or 'to insist'. It's the right word for continuing despite difficulties." },
            { id: 'c8q2', question: "天色渐渐暗了下来，路上的行人也（ ）变少了。", options: ["逐渐", "突然", "马上"], correctAnswer: "逐渐", 
              explanation: "“逐渐”(zhú jiàn) 表示程度或数量慢慢地变化。", 
              annotatedSentence: `<span class="word-anno">行人<span class="pinyin">xíng rén</span></span><span class="word-anno">也<span class="pinyin">yě</span></span><span class="word-anno">逐渐<span class="pinyin">zhú jiàn</span></span><span class="word-anno">变少<span class="pinyin">biàn shǎo</span></span><span class="word-anno">了<span class="pinyin">le</span></span>`, 
              englishExplanation: "English: '逐渐' (zhú jiàn) means 'gradually'. It describes a slow change over time, which fits the context of dusk." },
            { id: 'c8q3', question: "老师说话的（ ）音很温和，我们都很喜欢听他讲课。", options: ["声", "音", "调"], correctAnswer: "调", 
              explanation: "“声调”(shēng diào) 指的是说话的语气和高低。", 
              annotatedSentence: `<span class="word-anno">老师<span class="pinyin">lǎo shī</span></span><span class="word-anno">说话<span class="pinyin">shuō huà</span></span><span class="word-anno">的<span class="pinyin">de</span></span><span class="word-anno">声调<span class="pinyin">shēng diào</span></span><span class="word-anno">很<span class="pinyin">hěn</span></span><span class="word-anno">温和<span class="pinyin">wēn hé</span></span>`, 
              englishExplanation: "English: '声调' (shēng diào) means 'tone of voice'. It is the correct term to describe the quality of someone's speech." },
            { id: 'c8q4', question: "他做事非常（ ）真，从不马虎。", options: ["认", "忍", "刃"], correctAnswer: "认", 
              explanation: "“认真”(rèn zhēn) 指的是态度严肃，不马虎。", 
              annotatedSentence: `<span class="word-anno">他<span class="pinyin">tā</span></span><span class="word-anno">做事<span class="pinyin">zuò shì</span></span><span class="word-anno">非常<span class="pinyin">fēi cháng</span></span><span class="word-anno">认真<span class="pinyin">rèn zhēn</span></span>`, 
              englishExplanation: "English: '认真' (rèn zhēn) means 'conscientious' or 'serious' (in one's work). It's the opposite of being careless ('马虎')." },
            { id: 'c8q5', question: "小明因为弄坏了弟弟的玩具，心里感到很（ ）疚。", options: ["内", "那", "纳"], correctAnswer: "内", 
              explanation: "“内疚”(nèi jiù) 是指心里感到惭愧、不安。", 
              annotatedSentence: `<span class="word-anno">心里<span class="pinyin">xīn lǐ</span></span><span class="word-anno">感到<span class="pinyin">gǎn dào</span></span><span class="word-anno">很<span class="pinyin">hěn</span></span><span class="word-anno">内疚<span class="pinyin">nèi jiù</span></span>`, 
              englishExplanation: "English: '内疚' (nèi jiù) means 'to feel guilty'. '内' (nèi) means 'inner', reflecting an internal feeling of guilt." },
            { id: 'c8q6', question: "这是一项艰巨的（ ）务，但我们有信心完成它。", options: ["任", "认", "忍"], correctAnswer: "任", 
              explanation: "“任务”(rèn wu) 是指指定担当的责任。", 
              annotatedSentence: `<span class="word-anno">艰巨的<span class="pinyin">jiān jù de</span></span><span class="word-anno">任务<span class="pinyin">rèn wu</span></span>`, 
              englishExplanation: "English: '任务' (rèn wu) means 'task' or 'mission'. '任' (rèn) means to assign or take on a role." },
            { id: 'c8q7', question: "我们应该（ ）守纪律，做一个好学生。", options: ["遵", "尊", "樽"], correctAnswer: "遵", 
              explanation: "“遵守”(zūn shǒu) 指的是依照规定行动。", 
              annotatedSentence: `<span class="word-anno">我们<span class="pinyin">wǒ men</span></span><span class="word-anno">应该<span class="pinyin">yīng gāi</span></span><span class="word-anno">遵守<span class="pinyin">zūn shǒu</span></span><span class="word-anno">纪律<span class="pinyin">jì lǜ</span></span>`, 
              englishExplanation: "English: '遵守' (zūn shǒu) means 'to abide by' or 'to observe' (rules, discipline). '尊' (zūn) is for respect." },
            { id: 'c8q8', question: "他把皮球（ ）向空中，然后又稳稳地接住了。", options: ["抛", "抱", "跑"], correctAnswer: "抛", 
              explanation: "“抛”(pāo) 是指扔，投掷。", 
              annotatedSentence: `<span class="word-anno">他<span class="pinyin">tā</span></span><span class="word-anno">把<span class="pinyin">bǎ</span></span><span class="word-anno">皮球<span class="pinyin">pí qiú</span></span><span class="word-anno">抛<span class="pinyin">pāo</span></span><span class="word-anno">向<span class="pinyin">xiàng</span></span><span class="word-anno">空中<span class="pinyin">kōng zhōng</span></span>`, 
              englishExplanation: "English: '抛' (pāo) means 'to throw' or 'to toss'. Its hand radical (扌) indicates an action done with the hands." },
            { id: 'c8q9', question: "他被老师误会了，心里感到很（ ）屈。", options: ["委", "萎", "wei"], correctAnswer: "委", 
              explanation: "“委屈”(wěi qu) 是指受到不公平的对待而心里难过。", 
              annotatedSentence: `<span class="word-anno">心里<span class="pinyin">xīn lǐ</span></span><span class="word-anno">感到<span class="pinyin">gǎn dào</span></span><span class="word-anno">很<span class="pinyin">hěn</span></span><span class="word-anno">委屈<span class="pinyin">wěi qu</span></span>`, 
              englishExplanation: "English: '委屈' (wěi qu) is the feeling of being wronged or suffering an injustice. It's a common feeling when one is misunderstood." },
            { id: 'c8q10', question: "这部电影的情节很（ ）动，许多观众都看哭了。", options: ["感", "敢", "橄"], correctAnswer: "感", 
              explanation: "“感动”(gǎn dòng) 是指思想感情受外界事物的影响而激动。", 
              annotatedSentence: `<span class="word-anno">情节<span class="pinyin">qíng jié</span></span><span class="word-anno">很<span class="pinyin">hěn</span></span><span class="word-anno">感动<span class="pinyin">gǎn dòng</span></span>`, 
              englishExplanation: "English: '感动' (gǎn dòng) means 'to be moved' or 'touching'. It's the right word to describe a plot that makes people cry." },
            { id: 'c8q11', question: "不管遇到什么挫（ ），我们都要勇敢地面对。", options: ["折", "拆", "逝"], correctAnswer: "折", 
              explanation: "“挫折”(cuò zhé) 指的是失败，失利。", 
              annotatedSentence: `<span class="word-anno">遇到<span class="pinyin">yù dào</span></span><span class="word-anno">什么<span class="pinyin">shén me</span></span><span class="word-anno">挫折<span class="pinyin">cuò zhé</span></span>`, 
              englishExplanation: "English: '挫折' (cuò zhé) means 'setback' or 'frustration'. It's something one must face bravely." },
            { id: 'c8q12', question: "为了（ ）备这次重要的考试，他每天都复习到深夜。", options: ["准", "推", "淮"], correctAnswer: "准", 
              explanation: "“准备”(zhǔn bèi) 是指预先安排或筹划。", 
              annotatedSentence: `<span class="word-anno">为了<span class="pinyin">wèi le</span></span><span class="word-anno">准备<span class="pinyin">zhǔn bèi</span></span><span class="word-anno">这次<span class="pinyin">zhè cì</span></span><span class="word-anno">考试<span class="pinyin">kǎo shì</span></span>`, 
              englishExplanation: "English: '准备' (zhǔn bèi) means 'to prepare'. It is the correct action to take before an important exam." },
            { id: 'c8q13', question: "这件衣服的（ ）料很特别，摸起来很舒服。", options: ["材", "才", "财"], correctAnswer: "材", 
              explanation: "“材料”(cái liào) 是指可以制成成品的物质。", 
              annotatedSentence: `<span class="word-anno">这件<span class="pinyin">zhè jiàn</span></span><span class="word-anno">衣服<span class="pinyin">yī fu</span></span><span class="word-anno">的<span class="pinyin">de</span></span><span class="word-anno">材料<span class="pinyin">cái liào</span></span><span class="word-anno">很<span class="pinyin">hěn</span></span><span class="word-anno">特别<span class="pinyin">tè bié</span></span>`, 
              englishExplanation: "English: '材料' (cái liào) means 'material' or 'fabric'. The wood radical (木) in '材' is a clue. '才' is talent and '财' is wealth." },
            { id: 'c8q14', question: "他（ ）心，一定能把这件事办好。", options: ["决", "诀", "抉"], correctAnswer: "决", 
              explanation: "“决心”(jué xīn) 是指坚定不移的意志。", 
              annotatedSentence: `<span class="word-anno">他<span class="pinyin">tā</span></span><span class="word-anno">决心<span class="pinyin">jué xīn</span></span>`, 
              englishExplanation: "English: '决心' (jué xīn) means 'determination' or 'to be determined'. '决' means decisive. The other characters are incorrect here." },
            { id: 'c8q15', question: "这件事的（ ）任在我，我愿意承担一切后果。", options: ["责", "责", "zé"], correctAnswer: "责", 
              explanation: "“责任”(zé rèn) 指的是应尽的义务，或应承担的过失。", 
              annotatedSentence: `<span class="word-anno">这件事<span class="pinyin">zhè jiàn shì</span></span><span class="word-anno">的<span class="pinyin">de</span></span><span class="word-anno">责任<span class="pinyin">zé rèn</span></span><span class="word-anno">在<span class="pinyin">zài</span></span><span class="word-anno">我<span class="pinyin">wǒ</span></span>`, 
              englishExplanation: "English: '责任' (zé rèn) means 'responsibility'. The sentence is about taking responsibility for one's actions." },
            { id: 'c8q16', question: "这个（ ）案的设计非常巧妙，得到了大家的一致好评。", options: ["图", "途", "涂"], correctAnswer: "图", 
              explanation: "“图案”(tú àn) 指的是有装饰意味的花纹或图形。", 
              annotatedSentence: `<span class="word-anno">这个<span class="pinyin">zhè ge</span></span><span class="word-anno">图案<span class="pinyin">tú àn</span></span><span class="word-anno">的<span class="pinyin">de</span></span><span class="word-anno">设计<span class="pinyin">shè jì</span></span><span class="word-anno">很<span class="pinyin">hěn</span></span><span class="word-anno">巧妙<span class="pinyin">qiǎo miào</span></span>`, 
              englishExplanation: "English: '图案' (tú àn) means 'pattern' or 'design'. '图' means picture. '途' is path, '涂' is to paint." },
            { id: 'c8q17', question: "大家（ ）在一起，商量着如何解决这个问题。", options: ["聚", "娶", "取"], correctAnswer: "聚", 
              explanation: "“聚集”(jù jí) 是指集合，凑在一起。", 
              annotatedSentence: `<span class="word-anno">大家<span class="pinyin">dà jiā</span></span><span class="word-anno">聚<span class="pinyin">jù</span></span><span class="word-anno">在<span class="pinyin">zài</span></span><span class="word-anno">一起<span class="pinyin">yī qǐ</span></span>`, 
              englishExplanation: "English: '聚' (jù) means 'to gather'. It's the action of people coming together." },
            { id: 'c8q18', question: "他把垃圾（ ）进垃圾桶里。", options: ["扔", "reng", "réng"], correctAnswer: "扔", 
              explanation: "“扔”(rēng) 是指抛，丢弃。", 
              annotatedSentence: `<span class="word-anno">他<span class="pinyin">tā</span></span><span class="word-anno">把<span class="pinyin">bǎ</span></span><span class="word-anno">垃圾<span class="pinyin">lā jī</span></span><span class="word-anno">扔<span class="pinyin">rēng</span></span><span class="word-anno">进<span class="pinyin">jìn</span></span><span class="word-anno">垃圾桶<span class="pinyin">lā jī tǒng</span></span><span class="word-anno">里<span class="pinyin">lǐ</span></span>`, 
              englishExplanation: "English: '扔' (rēng) means 'to throw away'. The hand radical (扌) indicates it's an action." },
            { id: 'c8q19', question: "这是一条（ ）便的小路，可以很快地到达目的地。", options: ["方", "放", "仿"], correctAnswer: "方", 
              explanation: "“方便”(fāng biàn) 指的是便利，省事。", 
              annotatedSentence: `<span class="word-anno">这是一条<span class="pinyin">zhè shì yī tiáo</span></span><span class="word-anno">方便<span class="pinyin">fāng biàn</span></span><span class="word-anno">的<span class="pinyin">de</span></span><span class="word-anno">小路<span class="pinyin">xiǎo lù</span></span>`, 
              englishExplanation: "English: '方便' (fāng biàn) means 'convenient'. A convenient path is one that saves time or effort." },
            { id: 'c8q20', question: "他（ ）有地看着我，好像有什么话要说。", options: ["似", " sì", "shì"], correctAnswer: "似", 
              explanation: "“似的”(shì de) 是助词，表示好像。", 
              annotatedSentence: `<span class="word-anno">他<span class="pinyin">tā</span></span><span class="word-anno">若有所思<span class="pinyin">ruò yǒu suǒ sī</span></span><span class="word-anno">地<span class="pinyin">de</span></span><span class="word-anno">看<span class="pinyin">kàn</span></span><span class="word-anno">着<span class="pinyin">zhe</span></span><span class="word-anno">我<span class="pinyin">wǒ</span></span>`, 
              englishExplanation: "English: The word is '似的' (shì de), which acts as a particle meaning 'like' or 'as if'. However, the more common usage for '似' is in '似乎' (sì hū), meaning 'it seems'." }
        ],
        "第九组：辨字与理解 (Hard)": [
            { id: 'c9q1', question: "为了（ ）止森林火灾，公园里禁止吸烟。", options: ["防", "访", "仿"], correctAnswer: "防", 
              explanation: "“防止”(fáng zhǐ) 是预先采取措施避免。“访”是拜访。“仿”是模仿。", 
              annotatedSentence: `<span class="word-anno">为了<span class="pinyin">wèi le</span></span><span class="word-anno">防止<span class="pinyin">fáng zhǐ</span></span><span class="word-anno">森林<span class="pinyin">sēn lín</span></span><span class="word-anno">火灾<span class="pinyin">huǒ zāi</span></span>`, 
              englishExplanation: "English: '防' (fáng) means 'to prevent'. It has the 'ear' radical on the right (阝). '访' (fǎng) is to visit, and '仿' (fǎng) is to imitate." },
            { id: 'c9q2', question: "这部卡车载（ ）了太多货物，轮胎都快压扁了。", options: ["载", "栽", "裁"], correctAnswer: "载", 
              explanation: "“载”(zài) 是指用交通工具装东西。“栽”是种植。“裁”是裁剪。", 
              annotatedSentence: `<span class="word-anno">卡车<span class="pinyin">kǎ chē</span></span><span class="word-anno">载<span class="pinyin">zài</span></span><span class="word-anno">了<span class="pinyin">le</span></span><span class="word-anno">太<span class="pinyin">tài</span></span><span class="word-anno">多<span class="pinyin">duō</span></span><span class="word-anno">货物<span class="pinyin">huò wù</span></span>`, 
              englishExplanation: "English: '载' (zài) means 'to carry' or 'to load', used for vehicles. '栽' (zāi) is to plant, '裁' (cái) is to cut fabric." },
            { id: 'c9q3', question: "这件事情的（ ）概情况就是这样。", options: ["概", "慨", "溉"], correctAnswer: "概", 
              explanation: "“大概”(dà gài) 指的是大致情况。“慨”是感慨。“溉”是灌溉。", 
              annotatedSentence: `<span class="word-anno">事情的<span class="pinyin">shì qíng de</span></span><span class="word-anno">大概<span class="pinyin">dà gài</span></span><span class="word-anno">情况<span class="pinyin">qíng kuàng</span></span>`, 
              englishExplanation: "English: The word is '大概' (dà gài), meaning 'general' or 'approximate'. '慨' (kǎi) is to sigh with emotion, '溉' (gài) is to irrigate." },
            { id: 'c9q4', question: "这是一口废（ ）的古井，里面已经没有水了。", options: ["弃", "弃", "qì"], correctAnswer: "弃", 
              explanation: "“废弃”(fèi qì) 是指抛弃不用。", 
              annotatedSentence: `<span class="word-anno">一口<span class="pinyin">yī kǒu</span></span><span class="word-anno">废弃<span class="pinyin">fèi qì</span></span><span class="word-anno">的<span class="pinyin">de</span></span><span class="word-anno">古井<span class="pinyin">gǔ jǐng</span></span>`, 
              englishExplanation: "English: '废弃' (fèi qì) means 'abandoned' or 'discarded'. '井' (jǐng) is a well. The question describes an abandoned well." },
            { id: 'c9q5', question: "看到这个感人的场面，他禁不住流下了眼（ ）。", options: ["泪", " lei", "lèi"], correctAnswer: "泪", 
              explanation: "“眼泪”(yǎn lèi) 是指眼睛流出的液体。", 
              annotatedSentence: `<span class="word-anno">流下了<span class="pinyin">liú xià le</span></span><span class="word-anno">眼泪<span class="pinyin">yǎn lèi</span></span>`, 
              englishExplanation: "English: The word for 'tears' is '眼泪' (yǎn lèi). The character is '泪' (lèi)." },
            { id: 'c9q6', question: "我们要节（ ）用水，保护水资源。", options: ["约", "药", "钓"], correctAnswer: "约", 
              explanation: "“节约”(jié yuē) 是指节省，不浪费。“药”是 medicine。“钓”是 to fish。", 
              annotatedSentence: `<span class="word-anno">我们<span class="pinyin">wǒ men</span></span><span class="word-anno">要<span class="pinyin">yào</span></span><span class="word-anno">节约<span class="pinyin">jié yuē</span></span><span class="word-anno">用水<span class="pinyin">yòng shuǐ</span></span>`, 
              englishExplanation: "English: The word for 'to conserve' or 'to save' is '节约' (jié yuē). '药' (yào) is medicine, '钓' (diào) is to fish." },
            { id: 'c9q7', question: "弟弟把玻璃杯打（ ）了，碎片撒了一地。", options: ["碎", "卒", "淬"], correctAnswer: "碎", 
              explanation: "“打碎”(dǎ suì) 是指使东西变成碎片。“卒”是士兵或死亡。“淬”是淬火。", 
              annotatedSentence: `<span class="word-anno">把<span class="pinyin">bǎ</span></span><span class="word-anno">玻璃杯<span class="pinyin">bō li bēi</span></span><span class="word-anno">打碎<span class="pinyin">dǎ suì</span></span><span class="word-anno">了<span class="pinyin">le</span></span>`, 
              englishExplanation: "English: The word '打碎' (dǎ suì) means 'to shatter'. '碎' (suì) has the 'stone' radical (石), indicating breaking something hard." },
            { id: 'c9q8', question: "这根（ ）子是用来支撑帐篷的。", options: ["柱", "住", "注"], correctAnswer: "柱", 
              explanation: "“柱子”(zhù zi) 是指建筑物中起支撑作用的构件。“住”是居住。“注”是注意。", 
              annotatedSentence: `<span class="word-anno">这根<span class="pinyin">zhè gēn</span></span><span class="word-anno">柱子<span class="pinyin">zhù zi</span></span>`, 
              englishExplanation: "English: '柱' (zhù) means 'pillar' or 'post'. It has the 'wood' radical (木). '住' (zhù) is to live, '注' (zhù) is to pay attention." },
            { id: 'c9q9', question: "你再这样（ ）闹下去，我就要生气了。", options: ["胡", "湖", "糊"], correctAnswer: "胡", 
              explanation: "“胡闹”(hú nào) 是指不讲道理地吵闹或做事。", 
              annotatedSentence: `<span class="word-anno">你<span class="pinyin">nǐ</span></span><span class="word-anno">再<span class="pinyin">zài</span></span><span class="word-anno">这样<span class="pinyin">zhè yàng</span></span><span class="word-anno">胡闹<span class="pinyin">hú nào</span></span><span class="word-anno">下去<span class="pinyin">xià qù</span></span>`, 
              englishExplanation: "English: The term for 'to fool around' or 'to cause trouble' is '胡闹' (hú nào). '湖' (hú) is lake, '糊' (hú) is paste." },
            { id: 'c9q10', question: "这项工程（ ）划得很好，进行得很顺利。", options: ["计", "汁", "针"], correctAnswer: "计", 
              explanation: "“计划”(jì huà) 是指预先拟定的工作内容、步骤和方法。", 
              annotatedSentence: `<span class="word-anno">这项<span class="pinyin">zhè xiàng</span></span><span class="word-anno">工程<span class="pinyin">gōng chéng</span></span><span class="word-anno">计划<span class="pinyin">jì huà</span></span><span class="word-anno">得<span class="pinyin">de</span></span><span class="word-anno">很<span class="pinyin">hěn</span></span><span class="word-anno">好<span class="pinyin">hǎo</span></span>`, 
              englishExplanation: "English: The word for 'plan' is '计划' (jì huà). '计' (jì) means to calculate or plan. '汁' (zhī) is juice, '针' (zhēn) is needle." },
            { id: 'c9q11', question: "这家（ ）乐部只对会员开放。", options: ["俱", "具", "惧"], correctAnswer: "俱", 
              explanation: "“俱乐部”(jù lè bù) 是进行社会、文化、娱乐等活动的团体和场所。", 
              annotatedSentence: `<span class="word-anno">这家<span class="pinyin">zhè jiā</span></span><span class="word-anno">俱乐部<span class="pinyin">jù lè bù</span></span>`, 
              englishExplanation: "English: The word for 'club' is '俱乐部' (jù lè bù). '俱' (jù) means 'all' or 'together'. '具' (jù) is tool, '惧' (jù) is to fear." },
            { id: 'c9q12', question: "他性格（ ）向，不爱说话，总是自己一个人呆着。", options: ["内", "内", "nèi"], correctAnswer: "内", 
              explanation: "“内向”(nèi xiàng) 是指人的性格、思想、感情等倾向于内心世界，不爱交际。", 
              annotatedSentence: `<span class="word-anno">他<span class="pinyin">tā</span></span><span class="word-anno">性格<span class="pinyin">xìng gé</span></span><span class="word-anno">内向<span class="pinyin">nèi xiàng</span></span>`, 
              englishExplanation: "English: '内向' (nèi xiàng) means 'introverted'. '内' (nèi) means 'inner'." },
            { id: 'c9q13', question: "这道题我怎么也想不出来，真是伤（ ）筋。", options: ["脑", "恼", "nao"], correctAnswer: "脑", 
              explanation: "“伤脑筋”(shāng nǎo jīn) 是指事情难办，费心思。", 
              annotatedSentence: `<span class="word-anno">真是<span class="pinyin">zhēn shi</span></span><span class="word-anno">伤脑筋<span class="pinyin">shāng nǎo jīn</span></span>`, 
              englishExplanation: "English: The idiom for 'bothersome' or 'a real headache' (of a problem) is '伤脑筋' (shāng nǎo jīn), literally 'to hurt the brain'. '脑' is brain, '恼' is to be vexed." },
            { id: 'c9q14', question: "爸爸出差了，妈妈（ ）自一人照顾我们。", options: ["独", " dú", "dú"], correctAnswer: "独", 
              explanation: "“独自”(dú zì) 是指自己一个人。", 
              annotatedSentence: `<span class="word-anno">妈妈<span class="pinyin">mā ma</span></span><span class="word-anno">独自<span class="pinyin">dú zì</span></span><span class="word-anno">一人<span class="pinyin">yī rén</span></span><span class="word-anno">照顾<span class="pinyin">zhào gù</span></span><span class="word-anno">我们<span class="pinyin">wǒ men</span></span>`, 
              englishExplanation: "English: '独自' (dú zì) means 'alone' or 'by oneself'. '独' (dú) has the 'dog' radical (犭)." },
            { id: 'c9q15', question: "这两种说法自相（ ）盾，肯定有一个是错的。", options: ["矛", "茅", "予"], correctAnswer: "矛", 
              explanation: "“矛盾”(máo dùn) 比喻言行相互抵触，不能自圆其说。“茅”是茅草。", 
              annotatedSentence: `<span class="word-anno">自相矛盾<span class="pinyin">zì xiāng máo dùn</span></span>`, 
              englishExplanation: "English: The idiom for 'self-contradictory' is '自相矛盾' (zì xiāng máo dùn). '矛' (máo) is spear. '茅' (máo) is a type of grass." },
            { id: 'c9q16', question: "（ ）然他很努力，但还是失败了。", options: ["虽", "虽", "suī"], correctAnswer: "虽", 
              explanation: "“虽然”(suī rán) 是连词，表示转折关系。", 
              annotatedSentence: `<span class="word-anno">虽然<span class="pinyin">suī rán</span></span><span class="word-anno">他<span class="pinyin">tā</span></span><span class="word-anno">很<span class="pinyin">hěn</span></span><span class="word-anno">努力<span class="pinyin">nǔ lì</span></span>`, 
              englishExplanation: "English: '虽然...但是...' (suī rán...dàn shì...) is a common structure meaning 'Although...but...'." },
            { id: 'c9q17', question: "他把钱（ ）在银行里，很安全。", options: ["存", "在", "才"], correctAnswer: "存", 
              explanation: "“存”(cún) 在这里是储存、存放的意思。“在”是 at。“才”是 only then。", 
              annotatedSentence: `<span class="word-anno">他<span class="pinyin">tā</span></span><span class="word-anno">把<span class="pinyin">bǎ</span></span><span class="word-anno">钱<span class="pinyin">qián</span></span><span class="word-anno">存<span class="pinyin">cún</span></span><span class="word-anno">在<span class="pinyin">zài</span></span><span class="word-anno">银行<span class="pinyin">yín háng</span></span><span class="word-anno">里<span class="pinyin">lǐ</span></span>`, 
              englishExplanation: "English: '存' (cún) means 'to deposit' or 'to save'. '在' (zài) means 'to be at/in', and '才' (cái) means 'then and only then'." },
            { id: 'c9q18', question: "我们是好朋友，不分（ ）此。", options: ["彼", "比", "皮"], correctAnswer: "彼", 
              explanation: "“彼此”(bǐ cǐ) 是指双方，这个和那个。", 
              annotatedSentence: `<span class="word-anno">不分<span class="pinyin">bù fēn</span></span><span class="word-anno">彼此<span class="pinyin">bǐ cǐ</span></span>`, 
              englishExplanation: "English: The phrase '不分彼此' (bù fēn bǐ cǐ) means 'to make no distinction between one another', implying a very close relationship. '彼' (bǐ) means 'that/other'." },
            { id: 'c9q19', question: "他的演讲激（ ）了在场所有人的爱国热情。", options: ["发", "拨", "泼"], correctAnswer: "发", 
              explanation: "“激发”(jī fā) 是指激动、焕发。", 
              annotatedSentence: `<span class="word-anno">他的<span class="pinyin">tā de</span></span><span class="word-anno">演讲<span class="pinyin">yǎn jiǎng</span></span><span class="word-anno">激发<span class="pinyin">jī fā</span></span><span class="word-anno">了<span class="pinyin">le</span></span><span class="word-anno">爱国<span class="pinyin">ài guó</span></span><span class="word-anno">热情<span class="pinyin">rè qíng</span></span>`, 
              englishExplanation: "English: '激发' (jī fā) means 'to inspire' or 'to arouse'. '激' is to stimulate, '发' is to emit." },
            { id: 'c9q20', question: "这口（ ）水很深，也很清澈。", options: ["井", "进", "jing"], correctAnswer: "井", 
              explanation: "“井”(jǐng) 是指从地里挖出来的取水坑。", 
              annotatedSentence: `<span class="word-anno">这口<span class="pinyin">zhè kǒu</span></span><span class="word-anno">井<span class="pinyin">jǐng</span></span><span class="word-anno">水<span class="pinyin">shuǐ</span></span><span class="word-anno">很<span class="pinyin">hěn</span></span><span class="word-anno">深<span class="pinyin">shēn</span></span>`, 
              englishExplanation: "English: The character for a 'water well' is '井' (jǐng). It even looks like the top of a well. '进' (jìn) means to enter." }
        ]
    };

    // --- State Variables, DOM Elements, and Core Logic ---
    let currentSetData = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let incorrectAnswers = [];
    let startTime;
    let endTime;
    let isRedoing = false;
    let proceedTimeoutId = null;
    let isWaitingToProceed = false;
    let userName = localStorage.getItem(USER_NAME_STORAGE_KEY) || '';

    const correctSound = new Tone.Synth({ oscillator: { type: 'triangle' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.05, release: 0.2 }, }).toDestination();
    const incorrectSound = new Tone.Synth({ oscillator: { type: 'square' }, envelope: { attack: 0.01, decay: 0.2, sustain: 0, release: 0.2 } }).toDestination();

    const confettiCanvas = document.getElementById('confettiCanvas');
    const myConfetti = confetti.create(confettiCanvas, { resize: true, useWorker: true });

    const nameModal = document.getElementById('nameModal');
    const userNameInput = document.getElementById('userNameInput');
    const setSelectionScreen = document.getElementById('setSelectionScreen');
    const setButtonsContainer = document.getElementById('setButtonsContainer');
    const flashcardScreen = document.getElementById('flashcardScreen');
    const resultsScreen = document.getElementById('resultsScreen');
    const progressText = document.getElementById('progressText');
    const progressBarFill = document.getElementById('progressBarFill');
    const flashcard = document.getElementById('flashcard');
    const questionText = document.getElementById('questionText');
    const feedbackText = document.getElementById('feedbackText');
    const feedbackIconContainer = document.getElementById('feedbackIconContainer');
    const continueText = document.getElementById('continueText');
    const choiceButtons = [ document.getElementById('choice1'), document.getElementById('choice2'), document.getElementById('choice3') ];
    const scoreDisplayEl = document.getElementById('scoreDisplay');
    const percentageEl = document.getElementById('percentage');
    const timeTakenEl = document.getElementById('timeTaken');
    const incorrectListContainer = document.getElementById('incorrectListContainer');
    const incorrectList = document.getElementById('incorrectList');
    const noIncorrectText = document.getElementById('noIncorrectText');
    const redoIncorrectButton = document.getElementById('redoIncorrectButton');
    const encouragementTextEl = document.getElementById('encouragementText');
    const resultsHeadingEl = document.getElementById('resultsHeading');
    const raceTrackContainer = document.querySelector('#resultsScreen .race-track-container');
    const raceTrackFillEl = document.getElementById('raceTrackFill');
    const rocketEl = document.getElementById('rocketEl');

    flashcard.addEventListener('click', () => {
        if (isWaitingToProceed &&
            !flashcard.classList.contains('incorrect-state') &&
            (flashcard.classList.contains('correct-state-static') || flashcard.classList.contains('clickable-card'))) {
            proceedToNext();
        }
    });
    userNameInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            event.preventDefault();
            saveUserName();
        }
    });

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function populateStartButton() {
        setButtonsContainer.innerHTML = '';
        Object.keys(allFlashcardSets).forEach(setName => {
            const set = allFlashcardSets[setName];
            if (set.length >= QUESTIONS_PER_SET) {
                const button = document.createElement('button');
                button.textContent = `开始 ${setName}`;
                button.className = `action-button w-full py-4 px-6 bg-teal-500 hover:bg-teal-600 text-white mb-3 last:mb-0 text-lg`; 
                button.onclick = () => startFlashcardSession(set, setName);
                setButtonsContainer.appendChild(button);
            } else {
                const errorP = document.createElement('p');
                errorP.className = "text-red-500 text-sm";
                errorP.textContent = `Error: The set "${setName}" does not have enough questions (${set.length} found, ${QUESTIONS_PER_SET} required).`;
                setButtonsContainer.appendChild(errorP);
            }
        });
    }

    function saveUserName() {
        const name = userNameInput.value.trim();
        userName = name ? name : '学习者';
        localStorage.setItem(USER_NAME_STORAGE_KEY, userName);
        nameModal.style.display = 'none';
        showSetSelection();
    }

    function startFlashcardSession(selectedSet, setName) {
        Tone.start().catch(e => console.warn("Audio context could not start:", e));
        let fullSetCopy = [...selectedSet]; 
        shuffleArray(fullSetCopy);
        currentSetData = fullSetCopy.slice(0, QUESTIONS_PER_SET); 
        currentSetData.setName = setName; 
        currentQuestionIndex = 0;
        score = 0;
        incorrectAnswers = [];
        isRedoing = false;
        setSelectionScreen.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        flashcardScreen.classList.remove('hidden');
        updateProgress(); 
        startTime = new Date();
        displayQuestion();
    }

    function resetCardState() {
        if (proceedTimeoutId) { clearTimeout(proceedTimeoutId); proceedTimeoutId = null; }
        isWaitingToProceed = false;
        flashcard.classList.remove('shake', 'correct-state-static', 'incorrect-state', 'clickable-card');
        questionText.classList.remove('hidden');
        feedbackText.innerHTML = '';
        feedbackIconContainer.classList.add('hidden');
        continueText.classList.add('hidden');
        choiceButtons.forEach(btn => {
            btn.className = 'choice-button bg-slate-100 hover:bg-slate-200 text-slate-700';
        });
    }

    function displayQuestion() {
        resetCardState();
        if (currentQuestionIndex >= currentSetData.length) {
            showResults();
            return;
        }
        const questionData = currentSetData[currentQuestionIndex];
        questionText.innerHTML = questionData.question.replace(/\n/g, '<br>');
        let displayOptions = [...questionData.options];
        shuffleArray(displayOptions);
        choiceButtons.forEach((button, index) => {
            if (displayOptions[index] !== undefined) {
                button.textContent = displayOptions[index];
                button.disabled = false;
                button.dataset.answer = displayOptions[index];
                button.onclick = () => checkAnswer(button);
                button.style.display = 'flex';
            } else {
                button.style.display = 'none'; 
            }
        });
    }

    function updateProgress() {
        const totalQuestions = currentSetData.length;
        const completed = currentQuestionIndex;
        const progressPercentage = totalQuestions > 0 ? (completed / totalQuestions) * 100 : 0;
        progressText.textContent = `${completed} / ${totalQuestions}`;
        progressBarFill.style.width = `${progressPercentage}%`;
    }

    function checkAnswer(button) {
        Tone.start().catch(e => console.warn("Audio context failed:", e));
        if (isWaitingToProceed && !flashcard.classList.contains('incorrect-state')) return;
        const selectedAnswer = button.dataset.answer;
        const questionData = currentSetData[currentQuestionIndex];
        const correctAnswer = questionData.correctAnswer;
        choiceButtons.forEach(btn => btn.disabled = true);

        if (selectedAnswer === correctAnswer) {
            if (!isRedoing) score++;
            flashcard.classList.add('correct-state-static');
            feedbackIconContainer.innerHTML = '<span class="text-7xl md:text-8xl">✓</span>';
            feedbackIconContainer.classList.remove('hidden');
            questionText.classList.add('hidden');
            feedbackText.textContent = '正确!';
            myConfetti({ particleCount: 120, spread: 80, origin: { y: 0.6 } });
            correctSound.triggerAttackRelease("G5", "8n", Tone.now());
            button.className = 'choice-button bg-emerald-600 text-white ring-2 ring-emerald-800 shadow-md';
            isWaitingToProceed = true;
            flashcard.classList.add('clickable-card');
            continueText.classList.remove('hidden');
            proceedTimeoutId = setTimeout(proceedToNext, AUTO_PROCEED_DELAY);
            currentQuestionIndex++; 
            updateProgress(); 
        } else {
            flashcard.classList.add('shake', 'incorrect-state');
            feedbackIconContainer.innerHTML = '<span class="text-7xl md:text-8xl">✗</span>';
            feedbackIconContainer.classList.remove('hidden');
            questionText.classList.add('hidden'); 
            
            const annotatedSentenceHTML = (questionData.annotatedSentence || "").replace('（ ）', `<span class="word-anno" style="color:#ffdd57; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">${correctAnswer}<span class="pinyin"> </span></span>`);
            const englishExplanation = questionData.englishExplanation || "";
            const chineseExplanation = questionData.explanation || "没有解析。";
            
            feedbackText.innerHTML = `
                <div class="annotated-sentence-container">${annotatedSentenceHTML}</div>
                <div class="english-explanation">${englishExplanation}</div>
                <div class="explanation-box"><b>中文解析:</b> ${chineseExplanation}</div>
                <div class="prompt-guidance">点击绿色正确答案继续。</div>
            `;

            incorrectSound.triggerAttackRelease("C3", "8n");
            if (!isRedoing) {
                incorrectAnswers.push({ questionData: questionData, userAnswer: selectedAnswer });
            }
            isWaitingToProceed = false;
            flashcard.classList.remove('clickable-card');
            if (proceedTimeoutId) { clearTimeout(proceedTimeoutId); }
            choiceButtons.forEach(btn => {
                if (btn.dataset.answer === correctAnswer) {
                    btn.className = 'choice-button bg-emerald-500 hover:bg-emerald-600 text-white';
                    btn.disabled = false;
                    btn.onclick = function() {
                        currentQuestionIndex++; 
                        updateProgress(); 
                        proceedToNext();
                    };
                } else if (btn === button) {
                    btn.className = 'choice-button bg-red-700 text-white ring-2 ring-red-900 shadow-md';
                } else {
                    btn.className = 'choice-button bg-slate-200 text-slate-500 forced-disabled-look';
                }
            });
        }
    }

    function proceedToNext() {
        if (proceedTimeoutId) { clearTimeout(proceedTimeoutId); }
        isWaitingToProceed = false;
        displayQuestion();
    }

    function showResults() {
        endTime = new Date();
        const timeDiff = Math.round((endTime - startTime) / 1000);
        const totalQuestions = currentSetData.length;
        const currentScore = isRedoing ? (totalQuestions - incorrectAnswers.length) : score;
        const percentage = totalQuestions > 0 ? Math.round((currentScore / totalQuestions) * 100) : 0;

        resultsHeadingEl.textContent = isRedoing ? '错题复习完成！' : `“${currentSetData.setName || '练习'}”完成!`;
        scoreDisplayEl.textContent = `${currentScore} / ${totalQuestions}`;
        percentageEl.textContent = `${percentage}`;
        timeTakenEl.textContent = `${timeDiff}`;

        if (percentage === 100) encouragementTextEl.textContent = "太棒了，满分！你已经掌握了这个部分！";
        else if (percentage >= 70) encouragementTextEl.textContent = "做得很好！继续努力，你非常出色。";
        else encouragementTextEl.textContent = "不错！复习一下错题，可以让你更强大。";
        
        flashcardScreen.classList.add('hidden');
        resultsScreen.classList.remove('hidden');
        
        requestAnimationFrame(() => {
            setTimeout(() => { 
                const trackWidth = raceTrackContainer.offsetWidth;
                const effectiveTrackWidth = trackWidth - rocketEl.offsetWidth; 
                const finalRocketPosition = Math.max(0, (percentage / 100) * effectiveTrackWidth);
                rocketEl.style.left = `${finalRocketPosition}px`;
                raceTrackFillEl.style.width = `${finalRocketPosition}px`;
            }, 100);
        });

        incorrectList.innerHTML = '';
        if (incorrectAnswers.length > 0) {
            incorrectListContainer.classList.remove('hidden'); noIncorrectText.classList.add('hidden');
            incorrectAnswers.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<b>问题:</b> ${item.questionData.question.replace(/\n/g, ' ')}<br/><b>你的答案:</b> <span class="text-red-500">${item.userAnswer}</span><br/><b>正确答案:</b> <span class="text-emerald-600">${item.questionData.correctAnswer}</span>`;
                incorrectList.appendChild(li);
            });
            redoIncorrectButton.classList.remove('hidden');
            redoIncorrectButton.disabled = isRedoing || incorrectAnswers.length === 0;
        } else {
            incorrectListContainer.classList.add('hidden'); noIncorrectText.classList.remove('hidden');
            redoIncorrectButton.classList.add('hidden');
        }

        sendResultsToGoogleSheet({
            setName: currentSetData.setName || "Unknown Set", score: currentScore, totalQuestions: totalQuestions,
            percentage: percentage, timeTaken: timeDiff,
            incorrectAnswersJSON: JSON.stringify(incorrectAnswers.map(item => ({ q: item.questionData.question, u: item.userAnswer, c: item.questionData.correctAnswer }))),
            name: userName, timestamp: new Date().toISOString() 
        });

        if (isRedoing) { incorrectAnswers = []; isRedoing = false; }
    }

    function sendResultsToGoogleSheet(data) {
        fetch(APPS_SCRIPT_URL, {
            method: 'POST', mode: 'no-cors', 
            headers: { 'Content-Type': 'application/json' }, 
            body: JSON.stringify({payloadType: 'flashcardResults', ...data, subject: 'Chinese' })
        }).catch(err => console.error("Failed to send results:", err));
    }

    function redoIncorrect() {
        if (incorrectAnswers.length === 0) return;
        const originalSetName = currentSetData.setName.replace(" (重做)", "");
        currentSetData = incorrectAnswers.map(item => item.questionData);
        currentSetData.setName = `${originalSetName} (重做)`;
        currentQuestionIndex = 0;
        incorrectAnswers = []; 
        isRedoing = true;
        resultsScreen.classList.add('hidden');
        flashcardScreen.classList.remove('hidden');
        startTime = new Date();
        updateProgress(); 
        displayQuestion();
    }

    function showSetSelection() {
        if (proceedTimeoutId) { clearTimeout(proceedTimeoutId); }
        isWaitingToProceed = false; isRedoing = false; 
        nameModal.style.display = 'none';
        flashcardScreen.classList.add('hidden');
        resultsScreen.classList.add('hidden');
        setSelectionScreen.classList.remove('hidden');
        populateStartButton();
    }

    document.addEventListener('DOMContentLoaded', () => {
        userName = localStorage.getItem(USER_NAME_STORAGE_KEY) || '';
        if (userName) {
            showSetSelection(); 
        } else {
            nameModal.style.display = 'flex';
            userNameInput.focus();
        }
    });
</script>

</body>
</html>
